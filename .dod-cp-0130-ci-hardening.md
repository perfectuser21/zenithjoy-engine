# DoD - CI 硬化

QA: docs/QA-DECISION.md

## 验收标准

### P0-1: Evidence 真实结果

- [ ] CI 各步骤输出 check 结果 JSON 到 ci/out/checks/
      Test: tests/ci/evidence.test.ts
- [ ] generate-evidence.sh 汇总计算 qa_gate_passed（不再硬编码）
      Test: tests/ci/evidence.test.ts
- [ ] evidence-gate.sh 验证 required checks 全存在且 ok
      Test: tests/ci/evidence.test.ts
- [ ] evidence-gate.sh 验证文件 hash 防篡改
      Test: tests/ci/evidence.test.ts

### P0-2: manual: 后门封堵

- [ ] check-dod-mapping.cjs manual: 不再直接 valid:true
      Test: tests/gate/scan-rci-coverage.test.ts
- [ ] manual: 必须在 evidence 中有 manual_verifications
      Test: tests/gate/scan-rci-coverage.test.ts
- [ ] manual_verifications 必须包含 actor/timestamp/evidence
      Test: tests/gate/scan-rci-coverage.test.ts

### P1-1: L2A/L2B 内容验证

- [ ] L2A PRD 必须 >=3 section，每 section >=2 行
      Test: tests/devgate/l2a-check.test.ts
- [ ] L2A DoD 必须有验收项且每项有 Test 映射
      Test: tests/devgate/l2a-check.test.ts
- [ ] L2B Evidence 必须有可复现命令或机器引用
      Test: contract:C8-001

### P1-2: RCI coverage 收紧

- [ ] 禁止 name/includes 误判，只允许精确路径匹配
      Test: tests/gate/scan-rci-coverage.test.ts

### 测试验收

- [ ] npm run test 通过
      Test: contract:C2-001
- [ ] 故意让 test 失败时 evidence FAIL（由测试验证）
      Test: tests/ci/evidence.test.ts
