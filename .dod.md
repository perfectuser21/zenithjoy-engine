---
id: dod-phase1-devgate-closedloop
version: 1.0.0
created: 2026-01-22
updated: 2026-01-22
changelog:
  - 1.0.0: 初始版本
---

# DoD - Phase 1: /dev 工作流闭环改造

## 验收标准

### 1. DoD 映射检查脚本
- [x] `scripts/devgate/check-dod-mapping.cjs` 实现
  Test: tests/hooks/pr-gate-phase1.test.ts
- [x] 支持三种 Test 类型：`tests/`、`contract:`、`manual:`
  Test: tests/hooks/pr-gate-phase1.test.ts
- [x] 缺少 Test 字段返回错误
  Test: tests/hooks/pr-gate-phase1.test.ts

### 2. 优先级检测脚本
- [x] `scripts/devgate/detect-priority.cjs` 实现
  Test: tests/hooks/pr-gate-phase1.test.ts
- [x] 支持从 label/title/env 检测优先级
  Test: tests/hooks/pr-gate-phase1.test.ts

### 3. P0/P1 强制 RCI 更新
- [x] `scripts/devgate/require-rci-update-if-p0p1.sh` 实现
  Test: tests/hooks/pr-gate-phase1.test.ts
- [x] P0/P1 未更新 regression-contract.yaml 则失败
  Test: tests/hooks/pr-gate-phase1.test.ts

### 4. Hook 集成
- [x] `hooks/pr-gate-v2.sh` 调用 Phase 1 检查脚本
  Test: contract:H2-007
- [x] PR 模式触发 DoD 映射检查
  Test: contract:H2-007

### 5. CI 集成
- [x] `.github/workflows/ci.yml` 添加 devgate 检查步骤
  Test: contract:C6-001

### 6. 模板更新
- [x] `templates/DOD-TEMPLATE.md` 包含 Test 字段示例
  Test: manual:template-review

### 7. 回归契约更新
- [x] 新增 H2-007（DoD 映射检查）
  Test: manual:rci-review
- [x] 新增 C6-001（CI devgate 步骤）
  Test: manual:rci-review

### 8. 质量验收
- [x] npm run qa 通过
  Test: contract:C2-001
- [x] bash -n 所有 .sh 文件通过
  Test: contract:C3-001
