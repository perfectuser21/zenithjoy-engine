---
id: dod-fix-priority-detection-and-rci
version: 1.1.0
created: 2026-01-23
updated: 2026-01-23
changelog:
  - 1.1.0: 所有 Checkpoint 完成
  - 1.0.0: 初始版本
---

# DoD - 修复优先级检测 Bug 并补充 RCI

QA: docs/QA-DECISION.md

## Checkpoint 1: 修复 detect-priority.cjs Bug

- [x] 添加 CRITICAL → P0 映射
  Test: tests/hooks/detect-priority.test.ts
- [x] 添加 HIGH → P1 映射
  Test: tests/hooks/detect-priority.test.ts
- [x] 添加 security 关键字 → P0 映射
  Test: tests/hooks/detect-priority.test.ts
- [x] 单元测试覆盖新增映射（21 个测试）
  Test: tests/hooks/detect-priority.test.ts

## Checkpoint 2: 补充 v8.24.0 安全修复 RCI

- [x] 添加 RCI: H1-010 JSON 预验证 (branch-protect.sh)
  Test: contract:H1-010
- [x] 添加 RCI: H1-011 路径遍历检查 (branch-protect.sh)
  Test: contract:H1-011
- [x] 添加 RCI: H2-011 JSON 预验证 (pr-gate-v2.sh)
  Test: contract:H2-011
- [x] 添加 RCI: H2-012 sed 注入防护 (pr-gate-v2.sh)
  Test: contract:H2-012
- [x] 添加 RCI: H2-013 CRITICAL/HIGH 优先级映射
  Test: contract:H2-013
- [x] 添加 RCI: H4-003 id 格式白名单 (run-regression.sh)
  Test: contract:H4-003
- [x] 添加 RCI: C1-002 CI Job 权限声明
  Test: contract:C1-002
- [x] 添加 RCI: C1-003 curl JSON 安全生成
  Test: contract:C1-003

## Checkpoint 3: 更新文档

- [x] QA SKILL.md v1.2.0 添加 CRITICAL/HIGH → P0/P1 映射说明
  Test: manual:code-review
- [x] Audit SKILL.md v1.2.0 添加映射说明
  Test: manual:code-review

## 质量验收

- [x] npm run qa 通过（134 个测试全绿）
  Test: contract:C2-001
- [x] regression-contract.yaml v1.20.0 包含 8 个新 RCI
  Test: manual:verify
