---
id: dod-phase41-threshold
version: 1.0.0
created: 2026-01-22
updated: 2026-01-22
changelog:
  - 1.0.0: 初始版本
---

# DoD - Phase 4.1: DevGate L2 阈值检查

## 验收标准

### 1. metrics.cjs 增强
- [x] 添加 `offenders` 数组到 JSON 输出
  Test: tests/hooks/metrics.test.ts
- [x] 添加 `p0_manual_tests` 单独计数
  Test: tests/hooks/metrics.test.ts
- [x] human 输出显示 Top Offenders 列表
  Test: tests/hooks/metrics.test.ts

### 2. nightly.yml L2 阈值检查
- [x] 添加 "DevGate Threshold Check (L2)" 步骤
  Test: contract:C7-002
- [x] P0/P1 RCI < 100% 时输出 offenders 并 fail
  Test: manual:nightly-check
- [x] P0 manual tests > 0 时 fail
  Test: manual:nightly-check
- [x] RCI 增长 < 2 时输出软警告
  Test: manual:nightly-check

### 3. 回归契约更新
- [x] 新增 C7-002（L2 阈值检查）
  Test: manual:rci-review

### 4. 质量验收
- [x] npm run qa 通过
  Test: contract:C2-001
