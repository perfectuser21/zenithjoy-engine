---
id: dod-phase2-cross-repo-worktree
version: 1.0.0
created: 2026-01-28
updated: 2026-01-28
changelog:
  - 1.0.0: 初始版本
---

# DoD: Phase 2 跨仓库兼容性 + Worktree 支持

QA: docs/QA-DECISION.md

## 验收清单

### T-001: 移除硬编码路径
- [x] 无硬编码绝对路径
  Test: manual:code-review
- [x] 在其他仓库运行不报错
  Test: manual:cross-repo-test

### T-002: .git 目录检测兼容 worktree
- [x] 使用 -e .git 替代 -d .git（兼容 worktree 的 .git 文件）
  Test: manual:code-review
- [x] 在 worktree 中正确检测 git 仓库
  Test: manual:worktree-test

### T-003: 项目根目录检测兼容 worktree
- [x] worktree 中正确获取工作目录
  Test: manual:worktree-test
- [x] 状态文件存储在正确位置
  Test: manual:worktree-test

### T-004: develop 分支存在性检查
- [x] 自动检测 main/develop 作为 base 分支
  Test: manual:code-review
- [x] 无 develop 时不报错
  Test: manual:main-only-test

### T-005: cleanup.sh worktree 安全检查
- [x] 有 worktree 关联时跳过删除（step 4.5 已实现）
  Test: manual:worktree-test
- [x] 输出警告信息
  Test: manual:worktree-test

## 测试要求

- [x] npm test 通过（178 passed）
  Test: tests/hooks/install-hooks.test.ts
- [x] Shell 脚本语法检查通过
  Test: manual:bash-n
