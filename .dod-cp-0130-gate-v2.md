---
id: dod-gate-v2
version: 1.0.0
created: 2026-01-30
updated: 2026-01-30
---

# DoD: Gate 机制方案 A 改造

## 验收清单

### Gate 文件新字段

- [x] `generate-gate-file.sh`: 添加 `head_sha` 字段（当前 commit SHA）
  Test: manual:head_sha_verified

- [x] `generate-gate-file.sh`: 添加 `generated_at` 字段（ISO8601 格式）
  Test: manual:generated_at_verified

- [x] `generate-gate-file.sh`: 添加 `task_id` 字段（从分支名提取）
  Test: manual:task_id_verified

- [x] `generate-gate-file.sh`: 添加 `tool_version` 字段
  Test: manual:tool_version_verified

- [x] `verify-gate-signature.sh`: 验证新字段存在
  Test: manual:field_validation_verified

### Exit Code 分层

- [x] `verify-gate-signature.sh`: exit 0 = 验证通过
  Test: manual:exit_code_0_verified

- [x] `verify-gate-signature.sh`: exit 4 = 格式错误
  Test: manual:exit_code_4_verified

- [x] `verify-gate-signature.sh`: exit 5 = 签名校验失败
  Test: manual:exit_code_5_verified

- [x] `verify-gate-signature.sh`: exit 6 = 分支不匹配
  Test: manual:exit_code_6_verified

### 硬失败机制

- [x] `pr-gate-v2.sh`: verify 脚本不存在时 exit 2
  Test: manual:hard_fail_verified

- [x] `pr-gate-v2.sh`: 区分不同 exit code 给出具体错误提示
  Test: manual:error_message_verified

## 质量参考

QA: docs/QA-DECISION-cp-0130-gate-v2.md
