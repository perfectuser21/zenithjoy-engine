# L3 回归测试分析报告

## 1. Method: auto 的 RCI 统计

共 22 个 method: auto 的 RCI：

### Hooks (9个)
- H1-001, H1-002, H1-003 (分支保护)
- H2-001, H2-002, H2-003, H2-004, H2-005, H2-006 (PR Gate)

### CI (4个)
- C1-001 (版本检查)
- C2-001 (测试)
- C3-001 (Shell语法检查)
- C5-001 (Release检查)

### Export (6个)
- E1-001, E1-002, E1-003 (QA报告)
- E2-001, E2-002, E2-003 (开发会话报告)

### N8N (3个)
- N1-001, N1-002, N1-003 (Cecilia无头模式)

### Workflow (0个)
所有 workflow RCI 都是 method: manual

---

## 2. Evidence.type 分布

| Type | 数量 |
|------|------|
| log | 14 |
| command | 9 |
| file | 3 |
| exit_code | 3 |
| ci_job | 3 |
| screenshot | 1 |

---

## 3. Trigger 分类

### PR 触发的 RCI
- H1-001, H1-002
- H2-001, H2-002, H2-003, H2-005, H2-006
- C1-001, C2-001, C3-001
- N1-001
- W1-001, W1-002, W1-003, W3-001, W3-002, W5-001, W5-002

### Release 触发的 RCI
- H1-001, H1-002, H1-003
- H2-001, H2-002, H2-003, H2-004, H2-005, H2-006
- C1-001, C2-001, C3-001, C5-001
- E1-001, E1-002, E1-003, E2-001, E2-002, E2-003
- N1-001, N1-002, N1-003
- W1-001, W1-002, W1-003, W1-004, W1-005, W3-001, W3-002, W5-001, W5-002, W5-003, W5-004

---

## 4. 解析方案

系统有 yq 可用（`/usr/local/bin/yq`），直接使用 yq 解析 YAML。

### 解析策略
1. 使用 yq 遍历所有 section: hooks, workflow, ci, export, n8n
2. 提取每个 RCI 的字段: id, trigger, method, evidence
3. 输出格式: `id|trigger|method|evidence_type|evidence_run|evidence_contains`

### 可执行的 Evidence 类型
仅 `type: command` 的 evidence 可自动执行：
- evidence.run: 要执行的命令
- evidence.contains: 输出应匹配的正则

---

## 5. L3 回归脚本需要处理的 RCI

### PR 模式 (method=auto + trigger含PR + evidence.type=command)
需要运行的 RCI 较少，因为大部分是 log/exit_code 类型

### Release 模式 (method=auto + trigger含Release + evidence.type=command)
- C5-001: `bash scripts/release-check.sh` → contains "Release 检查通过"
- E1-001: `bash scripts/qa-report.sh | jq . > /dev/null && echo valid` → contains "valid"
- E1-002: `bash scripts/qa-report.sh | jq 'keys'` → contains "repo"
- E1-003: `bash scripts/qa-report.sh --fast | jq '.summary.overall'` → contains "[0-9]+"
- E2-002: `jq '.mode' .dev-runs/*-report.json` → contains "interactive|headless"
- E2-003: `jq '.quality_report' .dev-runs/*-report.json` → contains "L1_automated|L2_verification|L3_acceptance"
- N1-001: `cecilia --health` → contains "healthy.*true"
- N1-002: `cecilia -p n8n/test-prd.json -c CP-001 --output /tmp/test.json && cat /tmp/test.json` → contains "success"
