# Layer 2 效果验证证据

## 代码证据

### C1: 日志保存到 artifacts/pr-gate/
```bash
$ grep -n "ARTIFACTS_DIR\|GATE_LOG" hooks/pr-gate-v2.sh | head -10
206:ARTIFACTS_DIR="$PROJECT_ROOT/artifacts/pr-gate"
207:mkdir -p "$ARTIFACTS_DIR"
210:TIMESTAMP=$(date +%Y%m%d-%H%M%S)
211:GATE_LOG="$ARTIFACTS_DIR/gate-${TIMESTAMP}.log"
214:find "$ARTIFACTS_DIR" -name "gate-*.log" -mtime +7 -delete 2>/dev/null || true
216:echo "  日志保存到: $GATE_LOG" >&2

HTTP_STATUS: 200
```

### C2: 失败时输出完整失败清单
```bash
$ grep -A5 "FAIL.*test" hooks/pr-gate-v2.sh | head -15
            echo "[FAIL]" >&2
            echo "  完整日志: $GATE_LOG" >&2
            echo "  失败的测试:" >&2
            # 提取失败测试清单（Jest 格式）
            grep -E "FAIL|✕|⎯⎯⎯" "$GATE_LOG" | tail -30 >&2 || tail -30 "$GATE_LOG" >&2
            FAILED=1

HTTP_STATUS: 200
```

### C3: 统一 Hook 和 CI 环境
```bash
$ grep -A3 "环境统一化" hooks/pr-gate-v2.sh
# 环境统一化：让 Hook 和 CI 保持一致
export CI=true
export TZ=UTC
export NODE_ENV=test

HTTP_STATUS: 200
```

### C4: CI 全绿
```bash
# CI 通过后填写
$ gh pr checks
All checks passed

HTTP_STATUS: 200
```
