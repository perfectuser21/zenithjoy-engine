# Engine 开发经验记录

> 记录开发 zenithjoy-engine 过程中学到的经验和踩的坑

---

## 2026-01-16: 初始版本开发

### 踩的坑

1. **版本号不同步**
   - 问题：package.json 版本是 1.0.0，但 hook 注释写 v7.0
   - 解决：统一用 package.json 作为版本权威源

2. **完成度检查编号错误**
   - 问题：SKILL.md 说 20 项，但检查脚本只有 19 项
   - 解决：仔细核对清单和脚本的编号

3. **会话恢复不完整**
   - 问题：只检查 PR 是否存在，没检查是否已 CLOSED
   - 解决：用 `--state all` 获取所有状态，区分 MERGED/CLOSED/OPEN

4. **CI shell 检查条件错误**
   - 问题：只在 type=shell 时检查，但 npm 项目也有 .sh 文件
   - 解决：移除条件，始终检查 shell 脚本

5. **main 和 feature 分支冲突**
   - 问题：直接 PR 会有冲突，因为历史不同
   - 解决：创建 cp-* 分支合并，解决冲突后 PR

### 学到的

1. **每个 PR 必须更新版本号** - semver 规则
2. **完成度检查必须每次都跑** - □ 必要项全部完成
3. **分支策略**：main (stable) ← feature (dev) ← cp-* (task)
4. **知识分层**：全局 / 项目 / Engine 各有记录位置

### 最佳实践

1. 深度调查时可以连续修多轮，不需要每次都问用户
2. 临时标注（如"← 新增！"）要及时清理
3. 文档和代码的一致性很重要（README 要和实际配置匹配）

## 2026-01-16: 双层 Learn + 动态检查点

### 新增功能

1. **Step 2.5 上下文回顾** - PRD 前回顾 CHANGELOG、PR、架构、踩坑
2. **Step 7 双层 Learn** - Engine 层 + 项目层分别记录经验
3. **动态检查点** - 用 □/○ 标记，grep 自动计算数量

### 经验

1. **能自动化的就不要手动维护** - 硬编码数字容易出错
2. **上下文回顾能发现问题** - 测试时发现了过时的项目名引用
