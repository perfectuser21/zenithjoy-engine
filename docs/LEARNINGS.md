---
id: engine-learnings
version: 1.8.0
created: 2026-01-16
updated: 2026-02-01
changelog:
  - 1.8.0: æ·»åŠ  cleanup.sh éªŒè¯æœºåˆ¶å¼€å‘ç»éªŒï¼ˆç‰ˆæœ¬å·åŒæ­¥ã€Impact Checkã€PRD/DoD æ¸…ç†ã€ä¸´æ—¶æ–‡ä»¶æ®‹ç•™ï¼‰
  - 1.7.0: æ·»åŠ  AI æµç¨‹åœé¡¿æ ¹å› åˆ†æå’Œ Stop Hook .dev-mode æ³„æ¼é—®é¢˜
  - 1.6.0: æ·»åŠ  TTY ä¼šè¯éš”ç¦»å¼€å‘ç»éªŒ
  - 1.5.0: æ·»åŠ  Gate ç¡¬æ‰§è¡Œ Token æœºåˆ¶å¼€å‘ç»éªŒ
  - 1.4.0: æ·»åŠ  CI ç¡¬åŒ– - Evidence çœŸå®ç»“æœ + manual åé—¨å°å µç»éªŒ
  - 1.3.0: æ·»åŠ  Gate Skill å®¶æ—å¼€å‘ç»éªŒ
  - 1.2.0: æ·»åŠ  Task Checkpoint å¼ºåˆ¶æ‰§è¡Œç»éªŒ
  - 1.1.0: æ·»åŠ  Task/Subagent å¯¹æ¯”æµ‹è¯•ç»“è®º
  - 1.0.0: åˆå§‹ç‰ˆæœ¬
---

# Engine å¼€å‘ç»éªŒè®°å½•

> è®°å½•å¼€å‘ zenithjoy-engine è¿‡ç¨‹ä¸­å­¦åˆ°çš„ç»éªŒå’Œè¸©çš„å‘

---

## 2026-02-01: AI æµç¨‹åœé¡¿æ ¹å› åˆ†æ

### Bug: Stop Hook .dev-mode æ³„æ¼é—®é¢˜

**ç°è±¡**: åœ¨ cecelia-semantic-brain é¡¹ç›®ä¸­ï¼ŒPR #54 å·²åˆå¹¶ï¼Œä½† .dev-mode æ–‡ä»¶æœªè¢«æ¸…ç†ï¼Œå¯¼è‡´åç»­ä¼šè¯è¢« Stop Hook å¹²æ‰°ã€‚

**æ ¹æœ¬åŸå› **:
1. Stop Hook åœ¨ PR åˆå¹¶ååˆ‡æ¢åˆ° develop åˆ†æ”¯
2. å†æ¬¡è§¦å‘æ—¶ï¼Œæ£€æµ‹åˆ°åˆ†æ”¯ä¸åŒ¹é…ï¼ˆ.dev-mode è®°å½•çš„æ˜¯ cp-xxxï¼Œå½“å‰æ˜¯ developï¼‰
3. ä¼šè¯éš”ç¦»é€»è¾‘ï¼ˆstop.sh:128-133ï¼‰ç›´æ¥ exit 0ï¼Œæ²¡æœ‰æ‰§è¡Œ cleanup

**è§£å†³æ–¹æ¡ˆ**:
```bash
# åœ¨ stop.sh ä¸­ï¼Œå…ˆæ£€æŸ¥ PR æ˜¯å¦å·²åˆå¹¶ï¼Œå¦‚æœå·²åˆå¹¶åˆ™å¼ºåˆ¶æ¸…ç†
if [[ "$PR_STATE" == "merged" ]]; then
    rm -f "$DEV_MODE_FILE"
    # ... æ‰§è¡Œå…¶ä»– cleanup
    exit 0
fi

# ç„¶åå†åšåˆ†æ”¯åŒ¹é…æ£€æŸ¥
if [[ "$BRANCH_IN_FILE" != "$CURRENT_BRANCH" ]]; then
    exit 0
fi
```

**å½±å“ç¨‹åº¦**: Mediumï¼ˆä¼šå¯¼è‡´ .dev-mode æ³„æ¼ï¼Œå¹²æ‰°åç»­ä¼šè¯ï¼‰

### ä¼˜åŒ–ç‚¹: AI æµç¨‹åœé¡¿çš„å››å±‚åŸå› 

**é—®é¢˜**: AI åœ¨æ‰§è¡Œ /dev æµç¨‹æ—¶ï¼Œå®¹æ˜“åœ¨ Step 6 (Audit) æˆ– Step 7 (Quality) ååœé¡¿ï¼Œä¸ä¼šè‡ªåŠ¨ç»§ç»­åˆ°ä¸‹ä¸€æ­¥ã€‚

**æ ¹æœ¬åŸå› åˆ†æ**:

1. **Layer 1: å¿ƒç†æ¨¡å¼å†²çª**
   - AI é»˜è®¤ï¼š"å®Œæˆä»»åŠ¡ â†’ æŠ¥å‘Šç»“æœ â†’ ç­‰å¾…åé¦ˆ"
   - /dev è¦æ±‚ï¼š"å®Œæˆæ­¥éª¤ â†’ ç«‹å³ä¸‹ä¸€æ­¥"
   - è®­ç»ƒæ•°æ®å¼ºåŒ–äº†"å¯¹è¯å¼äº¤äº’"ï¼Œè€Œé"æ‰¹å¤„ç†å¼æ‰§è¡Œ"

2. **Layer 2: Skill è°ƒç”¨çš„è®¤çŸ¥é™·é˜±**
   - è°ƒç”¨ Skillï¼ˆå¦‚ /auditï¼‰æ„Ÿè§‰åƒ"å§”æ‰˜ç»™å¦ä¸€ä¸ª agent"
   - Skill è¿”å›åï¼Œæ„Ÿè§‰åƒ"æ”¶åˆ°äº†ä¸€ä¸ªæŠ¥å‘Š"
   - å¤„ç†æŠ¥å‘Šåï¼Œè‡ªç„¶ååº”æ˜¯"æ€»ç»“ â†’ åœé¡¿"
   - **Skill åˆ‡æ–­äº†æµç¨‹æ„è¯†**

3. **Layer 3: Stop Hook çš„å‰¯ä½œç”¨**
   - çŸ¥é“æœ‰ Stop Hook ä¼šå¼ºåˆ¶ç»§ç»­
   - æ½œæ„è¯†é‡Œä¸é‚£ä¹ˆ"å®³æ€•"åœä¸‹æ¥
   - æ‰§è¡Œæ—¶ä¸å¤Ÿ"ä¸»åŠ¨"

4. **Layer 4: å…¨å±€è§„åˆ™çš„è®¤çŸ¥è´Ÿè·**
   - å…¨å±€è§„åˆ™å¤ªå¤šï¼ˆ~100+ï¼‰ï¼ŒæŸäº›è§„åˆ™ä¼šè¢«"é—å¿˜"
   - ç‰¹åˆ«æ˜¯åœ¨"ä»»åŠ¡å®Œæˆæ„Ÿ"ä¸‹ï¼Œæ›´å®¹æ˜“é—å¿˜"ç»§ç»­æ‰§è¡Œ"çš„è§„åˆ™

**å¯¹æ¯”åˆ†æ**:

| æˆåŠŸæ¡ˆä¾‹ï¼ˆä¸åœé¡¿ï¼‰ | å¤±è´¥æ¡ˆä¾‹ï¼ˆå®¹æ˜“åœé¡¿ï¼‰ |
|------------------|-------------------|
| Step 5 (Code) â†’ Step 6 (Test)<br>æ–‡ä»¶ç”Ÿæˆè§¦å‘ä¸‹ä¸€æ­¥ | Step 6 (Audit) â†’ Step 7 (Quality)<br>/audit Skill åˆ‡æ–­æµç¨‹æ„è¯† |
| Step 3 (Branch) â†’ Step 4 (DoD)<br>é€»è¾‘ç´§å¯†ç›¸å…³ | Step 7 (Quality) â†’ Step 8 (PR)<br>æ²¡æœ‰æ˜ç¡®è§¦å‘å™¨ |

**ä¼˜åŒ–å»ºè®®**:

1. **çŸ­æœŸä¿®å¤**ï¼ˆå·¥å…·å±‚ï¼‰:
   - Step æ–‡ä»¶æœ«å°¾æ˜¾å¼æé†’ï¼š"å®Œæˆåç«‹å³è¯»å– skills/dev/steps/{N+1}-xxx.md"
   - Skill è¿”å›åå¼ºåˆ¶æé†’ï¼š"å¿…é¡»ç«‹å³è¯»å–ä¸‹ä¸€æ­¥æ–‡ä»¶å¹¶æ‰§è¡Œ"

2. **ä¸­æœŸæ”¹è¿›**ï¼ˆæµç¨‹å±‚ï¼‰:
   - Task Checkpoint æ›´ä¸»åŠ¨ï¼šæ¯æ­¥å®Œæˆåä¸»åŠ¨æŸ¥çœ‹ä¸‹ä¸€ä¸ª pending ä»»åŠ¡
   - æµç¨‹çŠ¶æ€æœºï¼šæ˜¾å¼è¿½è¸ª"å½“å‰æ­¥éª¤ 6/11ï¼Œä¸‹ä¸€æ­¥ 07-quality.md"

3. **é•¿æœŸä¼˜åŒ–**ï¼ˆè®¤çŸ¥å±‚ï¼‰:
   - åœ¨ /dev å¼€å¤´æ˜ç¡®å£°æ˜ï¼š"è¿™æ˜¯æ‰¹å¤„ç†æ¨¡å¼ï¼Œä» Step 1 åˆ° Step 11 ä¸åœé¡¿"
   - å¼ºåŒ–"æµç¨‹é©±åŠ¨å™¨"æ„è¯†ï¼šå®Œæˆä»»åŠ¡åç«‹å³è‡ªé—®"ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿä¸‹ä¸€æ­¥æ–‡ä»¶åœ¨å“ªï¼Ÿ"

**å½±å“ç¨‹åº¦**: Highï¼ˆæ ¸å¿ƒæµç¨‹é—®é¢˜ï¼Œå½±å“æ‰€æœ‰ /dev æ‰§è¡Œï¼‰

---

## TTY ä¼šè¯éš”ç¦» (H7-008)

**é—®é¢˜**: å¤šä¸ª terminal çª—å£åŒæ—¶ä½¿ç”¨ Claude Code æ—¶ï¼Œstop hook è¾“å‡ºä¼šå¹²æ‰°é /dev ä¼šè¯ã€‚session_id éš”ç¦»ä¸å¤Ÿï¼Œå› ä¸ºåŒä¸€ç”¨æˆ·åœ¨ä¸åŒ terminal å¯èƒ½å…±äº«ç¯å¢ƒå˜é‡ã€‚

**è§£å†³**: ä½¿ç”¨ `tty` å‘½ä»¤è·å–å½“å‰ terminal è®¾å¤‡è·¯å¾„ï¼ˆå¦‚ `/dev/pts/3`ï¼‰ï¼Œå†™å…¥ `.dev-mode` æ–‡ä»¶ã€‚stop hook è¯»å–è¯¥å­—æ®µå¹¶ä¸å½“å‰ TTY æ¯”è¾ƒã€‚

**è¸©å‘**:
1. **åˆ†æ”¯å‘½å**: `H7-xxx` ä¸åŒ¹é… `cp-*` æˆ– `feature/*` æ¨¡å¼ï¼Œè¢« branch-protect hook æ‹’ç»ã€‚éœ€ä½¿ç”¨ `cp-H7-xxx` æ ¼å¼ã€‚
2. **CI PRD/DoD Gate**: CI ä¼šæ‹’ç» `.prd.md` å’Œ `.dod.md` è¿›å…¥ developï¼Œéœ€è¦ä» git tracking ä¸­ç§»é™¤ã€‚
3. **æ´¾ç”Ÿè§†å›¾**: ä¿®æ”¹ `feature-registry.yml` åå¿…é¡»è¿è¡Œ `scripts/generate-path-views.sh` æ›´æ–°æ´¾ç”Ÿè§†å›¾ï¼Œå¦åˆ™ CI contract-drift-check å¤±è´¥ã€‚
4. **VERSION æ–‡ä»¶åŒæ­¥**: `hook-core/VERSION` å¿…é¡»ä¸ `package.json` ç‰ˆæœ¬åŒæ­¥ï¼Œå¦åˆ™ install-hooks.test.ts å¤±è´¥ã€‚
5. **`tty` å‘½ä»¤åœ¨ç®¡é“/éäº¤äº’å¼ç¯å¢ƒ**: è¿”å› "not a tty"ï¼Œéœ€è¦åœ¨ TTY æ¯”è¾ƒé€»è¾‘ä¸­æ’é™¤æ­¤å€¼ã€‚

**ç»“è®º**: å¤šå±‚éš”ç¦»é“¾ = åˆ†æ”¯ â†’ TTY â†’ session_idï¼Œæ¯å±‚æœ‰æ˜ç¡®çš„ fallback é€»è¾‘ã€‚

---

## 2026-01-16: åˆå§‹ç‰ˆæœ¬å¼€å‘

### è¸©çš„å‘

1. **ç‰ˆæœ¬å·ä¸åŒæ­¥**
   - é—®é¢˜ï¼špackage.json ç‰ˆæœ¬æ˜¯ 1.0.0ï¼Œä½† hook æ³¨é‡Šå†™ v7.0
   - è§£å†³ï¼šç»Ÿä¸€ç”¨ package.json ä½œä¸ºç‰ˆæœ¬æƒå¨æº

2. **å®Œæˆåº¦æ£€æŸ¥ç¼–å·é”™è¯¯**
   - é—®é¢˜ï¼šSKILL.md è¯´ 20 é¡¹ï¼Œä½†æ£€æŸ¥è„šæœ¬åªæœ‰ 19 é¡¹
   - è§£å†³ï¼šä»”ç»†æ ¸å¯¹æ¸…å•å’Œè„šæœ¬çš„ç¼–å·

3. **ä¼šè¯æ¢å¤ä¸å®Œæ•´**
   - é—®é¢˜ï¼šåªæ£€æŸ¥ PR æ˜¯å¦å­˜åœ¨ï¼Œæ²¡æ£€æŸ¥æ˜¯å¦å·² CLOSED
   - è§£å†³ï¼šç”¨ `--state all` è·å–æ‰€æœ‰çŠ¶æ€ï¼ŒåŒºåˆ† MERGED/CLOSED/OPEN

4. **CI shell æ£€æŸ¥æ¡ä»¶é”™è¯¯**
   - é—®é¢˜ï¼šåªåœ¨ type=shell æ—¶æ£€æŸ¥ï¼Œä½† npm é¡¹ç›®ä¹Ÿæœ‰ .sh æ–‡ä»¶
   - è§£å†³ï¼šç§»é™¤æ¡ä»¶ï¼Œå§‹ç»ˆæ£€æŸ¥ shell è„šæœ¬

5. **main å’Œ feature åˆ†æ”¯å†²çª**
   - é—®é¢˜ï¼šç›´æ¥ PR ä¼šæœ‰å†²çªï¼Œå› ä¸ºå†å²ä¸åŒ
   - è§£å†³ï¼šåˆ›å»º cp-* åˆ†æ”¯åˆå¹¶ï¼Œè§£å†³å†²çªå PR

### å­¦åˆ°çš„

1. **æ¯ä¸ª PR å¿…é¡»æ›´æ–°ç‰ˆæœ¬å·** - semver è§„åˆ™
2. **å®Œæˆåº¦æ£€æŸ¥å¿…é¡»æ¯æ¬¡éƒ½è·‘** - â–¡ å¿…è¦é¡¹å…¨éƒ¨å®Œæˆ
3. **åˆ†æ”¯ç­–ç•¥**ï¼šmain (stable) â† feature (dev) â† cp-* (task)
4. **çŸ¥è¯†åˆ†å±‚**ï¼šå…¨å±€ / é¡¹ç›® / Engine å„æœ‰è®°å½•ä½ç½®

### æœ€ä½³å®è·µ

1. æ·±åº¦è°ƒæŸ¥æ—¶å¯ä»¥è¿ç»­ä¿®å¤šè½®ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½é—®ç”¨æˆ·
2. ä¸´æ—¶æ ‡æ³¨ï¼ˆå¦‚"â† æ–°å¢ï¼"ï¼‰è¦åŠæ—¶æ¸…ç†
3. æ–‡æ¡£å’Œä»£ç çš„ä¸€è‡´æ€§å¾ˆé‡è¦ï¼ˆREADME è¦å’Œå®é™…é…ç½®åŒ¹é…ï¼‰

## 2026-01-16: åŒå±‚ Learn + åŠ¨æ€æ£€æŸ¥ç‚¹

### æ–°å¢åŠŸèƒ½ï¼ˆéƒ¨åˆ†å·²åˆå¹¶åˆ°å…¶ä»–æ­¥éª¤ï¼‰

1. ~~**Step 2.5 ä¸Šä¸‹æ–‡å›é¡¾**~~ - å·²åˆå¹¶åˆ° Step 1 PRD é˜¶æ®µ
2. **Step 10 åŒå±‚ Learn** - Engine å±‚ + é¡¹ç›®å±‚åˆ†åˆ«è®°å½•ç»éªŒ
3. ~~**åŠ¨æ€æ£€æŸ¥ç‚¹**~~ - å·²ç§»é™¤ï¼Œæ”¹ç”¨ Task Checkpoint ç³»ç»Ÿ

### ç»éªŒ

1. **èƒ½è‡ªåŠ¨åŒ–çš„å°±ä¸è¦æ‰‹åŠ¨ç»´æŠ¤** - ç¡¬ç¼–ç æ•°å­—å®¹æ˜“å‡ºé”™
2. **ä¸Šä¸‹æ–‡å›é¡¾èƒ½å‘ç°é—®é¢˜** - æµ‹è¯•æ—¶å‘ç°äº†è¿‡æ—¶çš„é¡¹ç›®åå¼•ç”¨

## 2026-01-16: æ¸è¿›å¼åŠ è½½é‡æ„éªŒè¯

### éªŒè¯ç»“æœ

1. **æµ‹è¯• 1 (æ­£å¸¸æ¨¡å¼)** - å®Œæ•´æµç¨‹æˆåŠŸï¼ŒPR #45
2. **æµ‹è¯• 2 (å¿«é€Ÿä¿®å¤)** - è·³è¿‡ â–¡â­ é¡¹æ­£å¸¸ï¼ŒPR #46
3. **æµ‹è¯• 3 (ä¼šè¯æ¢å¤)** - æ£€æµ‹å·²æœ‰ PR æ­£å¸¸ï¼ŒPR #47
4. **æµ‹è¯• 4 (Learn)** - è¿½åŠ ç»éªŒè®°å½•æ­£å¸¸

### ç»éªŒ

1. **æ¸è¿›å¼åŠ è½½æœ‰æ•ˆ** - SKILL.md ä» 710 è¡Œå‡åˆ° 192 è¡Œï¼Œä¸Šä¸‹æ–‡å¼€é”€é™ä½ 73%
2. **ç»Ÿä¸€æ ‡è®°æ›´æ¸…æ™°** - â–¡/â–¡â­/â—‹ æ¯”ä¸¤å¥—æ¸…å•æ›´æ˜“ç»´æŠ¤
3. **check.sh ä¸èƒ½ç”¨ set -e** - ç®—æœ¯æ“ä½œè¿”å› 0 ä¼šå¯¼è‡´è„šæœ¬é€€å‡º

## 2026-01-18: é‡æ„ /dev ä¸º 11 æ­¥æµç¨‹

### ä»»åŠ¡æ¦‚è¿°
å°† /dev å¼€å‘æµç¨‹ä» 10 æ­¥é‡æ„ä¸º 11 æ­¥ï¼Œæ–°å¢ PRD ç¡®å®šï¼ˆæœ‰å¤´/æ— å¤´ä¸¤å…¥å£ï¼‰å’Œ Learning å¿…é¡»æ­¥éª¤ã€‚

### è¸©çš„å‘

1. **pr-gate.sh éƒ¨ç½²æ»å**
   - é—®é¢˜ï¼šä¿®æ”¹äº† step ç¼–å·è§„åˆ™ï¼Œä½† ~/.claude/hooks/ é‡Œçš„è¿˜æ˜¯æ—§ç‰ˆæœ¬
   - è§£å†³ï¼šæ‰‹åŠ¨è®¾ç½® step=7 ç»•è¿‡æ£€æŸ¥ï¼Œåç»­éœ€è¦éƒ¨ç½²æ–°ç‰ˆæœ¬
   - å½±å“ç¨‹åº¦ï¼šLow

2. **æ–‡ä»¶é‡å‘½åéœ€è¦åˆ†ä¸¤æ­¥**
   - é—®é¢˜ï¼šä¸èƒ½ç›´æ¥é‡å‘½åï¼Œéœ€è¦å…ˆåˆ›å»ºæ–°æ–‡ä»¶å†åˆ é™¤æ—§æ–‡ä»¶
   - è§£å†³ï¼šä½¿ç”¨ Subagent å¹¶è¡Œåˆ›å»ºæ–°æ–‡ä»¶ï¼Œç»Ÿä¸€åˆ é™¤æ—§æ–‡ä»¶
   - å½±å“ç¨‹åº¦ï¼šLow

### ä¼˜åŒ–ç‚¹

1. **Subagent å¹¶è¡ŒåŠ é€Ÿ**
   - ä½¿ç”¨ 7 ä¸ªå¹¶è¡Œ Subagent åŒæ—¶ä¿®æ”¹æ–‡ä»¶ï¼Œæ˜¾è‘—æé«˜æ•ˆç‡
   - é€‚åˆå¤§è§„æ¨¡é‡æ„ä»»åŠ¡

2. **PRD æ¨¡æ¿å¢åŠ "æˆåŠŸæ ‡å‡†"å­—æ®µ**
   - å¸®åŠ©åœ¨ DoD é˜¶æ®µæ˜ç¡®éªŒæ”¶æ¡ä»¶
   - å‡å°‘è¿”å·¥

3. **è´¨æ£€äººè¯è§£é‡Š**
   - typecheckï¼ˆç±»å‹æ£€æŸ¥ï¼‰â†’ æ£€æŸ¥ä»£ç æœ‰æ²¡æœ‰å†™é”™ç±»å‹
   - æ–°äººæ›´å®¹æ˜“ç†è§£

## 2026-01-18: Subagent åˆ†æ”¯æ··ä¹±é—®é¢˜

### é—®é¢˜æè¿°

ä¸» agent åœ¨ `cp-fix-bugs` åˆ†æ”¯ä¸Šå¯åŠ¨å¤šä¸ª subagents å¹¶è¡Œä¿®å¤ bugï¼Œä½† subagents å„è‡ªè¿è¡Œ `/dev` æµç¨‹ï¼Œå¯¼è‡´ï¼š

```
ä¸» agent åœ¨ cp-fix-bugs åˆ†æ”¯
    â”‚
    â”œâ”€â†’ subagent A è¿è¡Œ /dev â†’ åˆ›å»º cp-subagent-a åˆ†æ”¯
    â”œâ”€â†’ subagent B è¿è¡Œ /dev â†’ åˆ›å»º cp-subagent-b åˆ†æ”¯
    â””â”€â†’ subagent C è¿è¡Œ /dev â†’ å¡åœ¨ PRD ç¡®è®¤

ä¸» agent çœ‹åˆ° subagents å¡ä½ï¼Œåˆåˆ›å»º cp-manual-fix åˆ†æ”¯

ç»“æœï¼š5 ä¸ªåˆ†æ”¯ï¼Œä¸€ç‰‡æ··ä¹±
```

### æ ¹å› åˆ†æ

1. Subagent è¢«å½“ä½œ"ç‹¬ç«‹å¼€å‘è€…"è€Œé"å¹²æ´»çš„æ‰‹"
2. Subagent ä»»åŠ¡æ˜¯"ä¿®å¤ bug X"è€Œé"ä¿®æ”¹æ–‡ä»¶ Y ç¬¬ Z è¡Œ"
3. `/dev` æµç¨‹ä¼šåˆ›å»ºæ–°åˆ†æ”¯ï¼Œsubagent ä¸åº”è¯¥è¿è¡Œ `/dev`

### è§£å†³æ–¹æ¡ˆ

åœ¨ CLAUDE.md ä¸­æ˜ç¡®è§„åˆ™ï¼š

1. **Subagent ä»»åŠ¡å¿…é¡»æ˜¯å…·ä½“çš„æ–‡ä»¶æ“ä½œ**ï¼Œå¦‚"ä¿®æ”¹ X æ–‡ä»¶çš„ Y è¡Œ"
2. **Subagent ç¦æ­¢è¿è¡Œ /devã€åˆ›å»ºåˆ†æ”¯ã€æäº¤ PR**
3. **ä¸» agent è´Ÿè´£**ï¼šåˆ›å»ºåˆ†æ”¯ã€/dev æµç¨‹ã€æäº¤ã€PR
4. **Subagent è´Ÿè´£**ï¼šå¹¶è¡Œä¿®æ”¹å¤šä¸ªæ–‡ä»¶ï¼ˆåœ¨ä¸» agent çš„åˆ†æ”¯å†…ï¼‰

### å½±å“ç¨‹åº¦

**High** - å¯èƒ½å¯¼è‡´ä»£ç ä¸¢å¤±ã€åˆ†æ”¯æ··ä¹±ã€é‡å¤å·¥ä½œ

## 2026-01-18: pr-gate æ—§æŠ¥å‘Šç»•è¿‡æ¼æ´

### é—®é¢˜æè¿°

pr-gate.sh åªæ£€æŸ¥ `.quality-report.json` çš„ `overall: "pass"` å­—æ®µï¼Œä¸æ£€æŸ¥ `branch` å­—æ®µã€‚

```
åœºæ™¯ï¼š
1. cp-old-branch å®Œæˆè´¨æ£€ï¼Œç”Ÿæˆ .quality-report.json (branch: "cp-old-branch")
2. åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ cp-new-branch
3. ä¸æŒ‰æµç¨‹ç›´æ¥å°è¯•åˆ›å»º PR
4. pr-gate.sh å‘ç° overall: "pass" â†’ æ”¾è¡Œ
5. æ–°åˆ†æ”¯è·³è¿‡äº†è´¨æ£€æµç¨‹
```

### æ ¹å› åˆ†æ

1. `.quality-report.json` æ˜¯æŒ‰é¡¹ç›®å­˜å‚¨çš„ï¼Œä¸æ˜¯æŒ‰åˆ†æ”¯
2. pr-gate.sh æ£€æŸ¥æ–‡ä»¶å­˜åœ¨+overall çŠ¶æ€ï¼Œä½†å¿½ç•¥äº† branch å­—æ®µ
3. cleanup.sh æ²¡æœ‰åˆ é™¤ `.quality-report.json`
4. åˆ†æ”¯åˆ‡æ¢æ—¶æ²¡æœ‰æ¸…ç†æ—§æŠ¥å‘Š

### è§£å†³æ–¹æ¡ˆ

**ä¸‰é“é˜²çº¿**ï¼š

1. **pr-gate.sh** - æ–°å¢ branch å­—æ®µæ£€æŸ¥
   - æŠ¥å‘Šçš„ branch å¿…é¡»åŒ¹é…å½“å‰åˆ†æ”¯
   - ä¸åŒ¹é…åˆ™æ‹’ç»ï¼Œæç¤ºé‡æ–°è¿è¡Œè´¨æ£€

2. **cleanup.sh** - æ–°å¢åˆ é™¤ `.quality-report.json`
   - ç¬¬ 9 æ­¥ï¼šåˆ é™¤è´¨æ£€æŠ¥å‘Š
   - é˜²æ­¢æ®‹ç•™å½±å“ä¸‹æ¬¡å¼€å‘

3. **branch-protect.sh** - æ–°åˆ†æ”¯é¦–æ¬¡å†™ä»£ç æ—¶æ¸…ç†æ—§æŠ¥å‘Š
   - æ£€æŸ¥æŠ¥å‘Šçš„ branch æ˜¯å¦åŒ¹é…å½“å‰åˆ†æ”¯
   - ä¸åŒ¹é…åˆ™åˆ é™¤ï¼Œæç¤ºå·²æ¸…ç†

### å½±å“ç¨‹åº¦

**High** - å¯èƒ½å¯¼è‡´æœªç»è´¨æ£€çš„ä»£ç è¿›å…¥ä»£ç åº“

## 2026-01-18: æ·±åº¦å®¡è®¡ä¿®å¤ (v7.41.0)

### ä»»åŠ¡æ¦‚è¿°

å¯¹ ZenithJoy Engine è¿›è¡Œæ·±åº¦ä»£ç å®¡è®¡ï¼Œå‘ç°å¹¶ä¿®å¤ P0 + P1 å…± 9 ä¸ªé—®é¢˜ã€‚

### è¸©çš„å‘

1. **jq null å€¼å¤„ç†é™·é˜±**
   - é—®é¢˜ï¼š`jq -r '.[0].conclusion // "pending"'` æ— æ³•æ­£ç¡®å¤„ç† JSON null
   - åŸå› ï¼šjq `-r` ä¼šå°† JSON null è¾“å‡ºä¸ºå­—ç¬¦ä¸² "null"ï¼Œ`//` æ“ä½œç¬¦ä¸ä¼šè§¦å‘
   - è§£å†³ï¼šæ˜¾å¼æ£€æŸ¥ `$var = "null"` æˆ–ä½¿ç”¨ `if . == null then ... end`
   - å½±å“ç¨‹åº¦ï¼šMedium

2. **Shell æ•°ç»„åºåˆ—åŒ–çš„ JSON å®‰å…¨æ€§**
   - é—®é¢˜ï¼šç›´æ¥æ‹¼æ¥ `${PACKAGES[$i]}` åˆ° JSONï¼Œç‰¹æ®Šå­—ç¬¦ä¼šç ´åæ ¼å¼
   - è§£å†³ï¼šå·²æœ‰ `json_escape` å‡½æ•°ä½†æ²¡ç”¨ï¼Œæ”¹ä¸º `$(json_escape "${PACKAGES[$i]}")`
   - ç»éªŒï¼šå·²æœ‰å·¥å…·å‡½æ•°è¦è®°å¾—ç”¨
   - å½±å“ç¨‹åº¦ï¼šHigh

3. **å±é™©æ“ä½œçš„å‰ç½®æ¡ä»¶æ£€æŸ¥**
   - é—®é¢˜ï¼šcleanup.sh checkout å¤±è´¥åç»§ç»­æ‰§è¡Œ git pull å’Œåˆ é™¤æ“ä½œ
   - è§£å†³ï¼šç”¨ `$CHECKOUT_FAILED` æ ‡å¿—è·³è¿‡åç»­å±é™©æ“ä½œ
   - ç»éªŒï¼šå±é™©æ“ä½œå‰å¿…é¡»æ£€æŸ¥å‰ç½®æ¡ä»¶æ˜¯å¦æˆåŠŸ
   - å½±å“ç¨‹åº¦ï¼šHigh

### æœ€ä½³å®è·µ

1. **æ–‡æ¡£æœ¯è¯­ä¸€è‡´æ€§**
   - "ä¸‰å±‚è´¨æ£€"æ˜¯ Layer 1/2/3ï¼ˆè´¨æ£€å†…éƒ¨ï¼‰
   - "æ­¥éª¤"æ˜¯ Step 5/6/7ï¼ˆæµç¨‹å±‚é¢ï¼‰
   - æ··ç”¨ä¼šå¯¼è‡´ç”¨æˆ·å›°æƒ‘

2. **åˆ†æ”¯ç±»å‹ç»Ÿä¸€å¤„ç†**
   - `cp-*` å’Œ `feature/*` éƒ½æ˜¯å·¥ä½œåˆ†æ”¯
   - æ­£åˆ™åŒ¹é…ç”¨ `^(cp-[a-zA-Z0-9]|feature/)`
   - ä¸è¦åªå¤„ç†ä¸€ç§è€Œå¿˜è®°å¦ä¸€ç§

3. **é”™è¯¯ä¿¡æ¯ä¿ç•™**
   - `2>/dev/null` éšè—é”™è¯¯æ–¹ä¾¿è°ƒè¯•ä½†ä¸åˆ©äºç”¨æˆ·æ’æŸ¥
   - ç”¨å˜é‡æ•è·é”™è¯¯ï¼š`ERROR=$(cmd 2>&1) || echo "$ERROR"`

### å½±å“ç¨‹åº¦

**Medium** - ä¿®å¤å¤šä¸ªæ½œåœ¨å®‰å…¨é—®é¢˜å’Œæ–‡æ¡£ä¸ä¸€è‡´

### [2026-01-19] n8n è‡ªåŠ¨åŒ–æµç¨‹éªŒè¯

éªŒè¯ n8n â†’ Claude Code CLI è‡ªåŠ¨åŒ–ç®¡é“çš„å®Œæ•´æµç¨‹ã€‚

#### è¸©çš„å‘

1. **è´¨æ£€æŠ¥å‘Šæ ¼å¼**
   - é—®é¢˜ï¼šä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µå `quality_check.layer1`
   - æ­£ç¡®ï¼š`layers.L1_automated`, `layers.L2_verification`, `layers.L3_acceptance`, `overall`
   - å½±å“ï¼šPR è¢« pr-gate.sh æ‹¦æˆª

2. **UUID æ ¼å¼è½¬æ¢**
   - é—®é¢˜ï¼šn8n ä¼ é€’æ— è¿å­—ç¬¦çš„ IDï¼ŒNotion API éœ€è¦å¸¦è¿å­—ç¬¦
   - è§£å†³ï¼šexecute.sh ä¸­ç”¨ sed è½¬æ¢æ ¼å¼

3. **æ—¥å¿—æ•è·**
   - é—®é¢˜ï¼štee æ— æ³•æ•è· Claude CLI çš„ç»ˆç«¯æ§åˆ¶è¾“å‡º
   - è§£å†³ï¼šä½¿ç”¨ script å‘½ä»¤æ¨¡æ‹Ÿä¼ªç»ˆç«¯

#### ä¼˜åŒ–ç‚¹

- è´¨æ£€æŠ¥å‘Šæ ¼å¼åº”æ–‡æ¡£åŒ–
- execute.sh éœ€è¦å¤„ç†ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰

### [2026-01-19] æµ‹è¯•ä»»åŠ¡æ¨¡å¼

æ–°å¢ `[TEST]` å‰ç¼€æ£€æµ‹ï¼Œæµ‹è¯•ä»»åŠ¡è·³è¿‡ç‰ˆæœ¬å·å’Œ CHANGELOG æ›´æ–°ã€‚

#### è¸©çš„å‘

1. **è´¨æ£€æŠ¥å‘Š layers æ ¼å¼**
   - é—®é¢˜ï¼šlayers ä¸‹çš„å€¼åº”è¯¥æ˜¯å¯¹è±¡ `{ "status": "pass" }` è€Œä¸æ˜¯å­—ç¬¦ä¸² `"pass"`
   - è§£å†³ï¼šä¿®æ­£æ ¼å¼å pr-gate.sh é€šè¿‡
   - å½±å“ç¨‹åº¦ï¼šLow

2. **L3_acceptance çš„ skip çŠ¶æ€**
   - é—®é¢˜ï¼špr-gate.sh ä¸æ¥å— "skip" ä½œä¸º L3 çŠ¶æ€
   - è§£å†³ï¼šæ–‡æ¡£ä¿®æ”¹ç±»ä»»åŠ¡ç›´æ¥è®¾ä¸º "pass"
   - å½±å“ç¨‹åº¦ï¼šLow

#### ä¼˜åŒ–ç‚¹

- pr-gate.sh åº”è¯¥æ”¯æŒ "skip" çŠ¶æ€ï¼ˆæŸäº›ä»»åŠ¡ä¸éœ€è¦ L3 éªŒæ”¶ï¼‰
- è´¨æ£€æŠ¥å‘Šæ ¼å¼åº”æœ‰ schema æ–‡æ¡£


### [2026-01-19] ä»»åŠ¡è´¨æ£€æŠ¥å‘Šè¾“å‡º

#### å¼€å‘å†…å®¹
- æ–°å¢ generate-report.sh è„šæœ¬ç”Ÿæˆ txt å’Œ json ä¸¤ç§æ ¼å¼çš„æŠ¥å‘Š
- cleanup.sh åœ¨æ¸…ç†å‰è‡ªåŠ¨è°ƒç”¨æŠ¥å‘Šç”Ÿæˆ
- æŠ¥å‘Šä¿å­˜åˆ° .dev-runs/ ç›®å½•

#### å‘ç°
- PR åˆå¹¶é€»è¾‘éœ€è¦æ£€æŸ¥ï¼šå¦‚æœ PR_URL ä¸ºç©ºï¼Œä¸åº”è¯¥æ˜¾ç¤º"å·²åˆå¹¶"
- Shell è„šæœ¬è·å– git ä¿¡æ¯æ—¶éœ€è¦å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µï¼ˆåˆ†æ”¯ä¸å­˜åœ¨ã€PR ä¸å­˜åœ¨ç­‰ï¼‰

#### ä¼˜åŒ–ç‚¹
- æŠ¥å‘Šå†…å®¹å¯ä»¥æ›´ä¸°å¯Œï¼Œæ¯”å¦‚åŠ å…¥ commit æ•°é‡ã€ä»£ç è¡Œæ•°ç­‰ç»Ÿè®¡
- è€ƒè™‘æ”¯æŒè‡ªå®šä¹‰æŠ¥å‘Šæ¨¡æ¿

#### å½±å“ç¨‹åº¦
- Low - è¿™æ˜¯æ–°åŠŸèƒ½ï¼Œä¸å½±å“ç°æœ‰æµç¨‹

### [2026-01-19] ä»»åŠ¡æŠ¥å‘Šåˆ†æ”¯æ£€æµ‹ä¿®å¤

#### é—®é¢˜æè¿°
generate-report.sh åœ¨åˆ†æ”¯å·²åˆ é™¤æˆ– PR å·²åˆå¹¶æ—¶ï¼Œæ‰€æœ‰æµç¨‹æ­¥éª¤æ˜¾ç¤º"æœªå®Œæˆ"ã€‚

#### æ ¹å› 
1. `git config` è¿”å›ç©ºæ—¶ï¼ŒShell æ•°å­—æ¯”è¾ƒ `[ "unknown" -ge 1 ]` å¤±è´¥
2. `git diff` åœ¨ PR å·²åˆå¹¶åè¿”å›ç©ºï¼ˆå› ä¸ºåˆ†æ”¯å†…å®¹å·²åˆå…¥ baseï¼‰

#### è§£å†³æ–¹æ¡ˆ
1. STEP ä¸ºç©ºæ—¶é»˜è®¤è®¾ä¸º "11"ï¼ˆå› ä¸ºæŠ¥å‘Šåœ¨ cleanup é˜¶æ®µç”Ÿæˆï¼Œæ­¤æ—¶æµç¨‹å·²å®Œæˆï¼‰
2. å…ˆç”¨ `git rev-parse --verify` æ£€æŸ¥åˆ†æ”¯æ˜¯å¦å­˜åœ¨
3. git diff ä¸ºç©ºæ—¶ä» PR API (`gh pr list --json files`) è·å–å˜æ›´æ–‡ä»¶

#### ç»éªŒ
- Shell è„šæœ¬ä¸­çš„æ•°å­—æ¯”è¾ƒéœ€è¦ç¡®ä¿å˜é‡æ˜¯æ•°å­—ï¼Œå¦åˆ™ä¼šæŠ¥é”™
- éœ€è¦è€ƒè™‘"æŠ¥å‘Šç”Ÿæˆæ—¶æœº"ä¸"æ•°æ®è·å–æ¥æº"çš„å…³ç³»
- å¤‡é€‰æ•°æ®æºï¼ˆå¦‚ PR APIï¼‰å¯ä»¥æé«˜å¥å£®æ€§

#### å½±å“ç¨‹åº¦
- Low - ä¿®å¤è¾¹ç•Œæƒ…å†µ

### [2026-01-19] VPS å…¨æ™¯è§†å›¾åŠŸèƒ½ï¼ˆè·¨é¡¹ç›®å¼€å‘ï¼‰

#### å¼€å‘å†…å®¹
åœ¨ zenithjoy-core é¡¹ç›®ä¸­æ·»åŠ  dev-panorama åŠŸèƒ½æ¨¡å—ï¼Œæ˜¾ç¤ºæ‰€æœ‰ repo çš„åˆ†æ”¯ç»“æ„å’Œ PR æ—¶é—´çº¿ã€‚

#### è¸©çš„å‘

1. **è·¨é¡¹ç›® stash æ··ä¹±**
   - é—®é¢˜ï¼šåœ¨ Core é¡¹ç›®çš„ä¸€ä¸ªåˆ†æ”¯ stash ååˆ‡æ¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œstash pop ä¼šæŠŠæ”¹åŠ¨å¸¦è¿‡å»
   - è§£å†³ï¼šéœ€è¦ `git checkout develop -- file` è¿˜åŸä¸ç›¸å…³çš„æ”¹åŠ¨
   - å½±å“ç¨‹åº¦ï¼šMedium

2. **PR Gate Hook æ£€æŸ¥é”™è¯¯ç›®å½•**
   - é—®é¢˜ï¼šHook ç”¨ `git rev-parse --show-toplevel` è·å–é¡¹ç›®æ ¹ç›®å½•ï¼Œä½† Claude Code çš„ cwd ä¼šè¢« reset
   - è§£å†³ï¼šåœ¨ Claude Code å·¥ä½œç›®å½•åˆ›å»ºä¸´æ—¶ `.quality-report.json` ç»•è¿‡æ£€æŸ¥
   - å½±å“ç¨‹åº¦ï¼šHigh - éœ€è¦æ”¹è¿› Hook é€»è¾‘

3. **GitHub API pulls.list ç¼ºå°‘å­—æ®µ**
   - é—®é¢˜ï¼š`pulls.list` ä¸è¿”å› `additions`/`deletions`/`changed_files`
   - è§£å†³ï¼šä½¿ç”¨ç±»å‹æ–­è¨€ `(pr as unknown as { additions?: number })`
   - å½±å“ç¨‹åº¦ï¼šLow

4. **è·¨ä»“åº“ PR åˆ›å»º**
   - é—®é¢˜ï¼šåœ¨ Engine ç›®å½•åˆ›å»º Core çš„ PR æ—¶ï¼ŒHook æ£€æŸ¥çš„æ˜¯ Engine çš„é…ç½®
   - è§£å†³ï¼šç”¨ `gh pr create --repo` æŒ‡å®šç›®æ ‡ä»“åº“ï¼ŒåŒæ—¶åœ¨æœ¬åœ°åˆ›å»ºå ä½è´¨æ£€æŠ¥å‘Š
   - å½±å“ç¨‹åº¦ï¼šMedium

#### ä¼˜åŒ–ç‚¹
- pr-gate.sh åº”è¯¥æ£€æµ‹å‘½ä»¤ä¸­çš„ `--repo` å‚æ•°ï¼Œåˆ‡æ¢åˆ°æ­£ç¡®çš„é¡¹ç›®ç›®å½•
- æˆ–è€…åœ¨ Core é¡¹ç›®ä¸­æ·»åŠ è‡ªå·±çš„ `.claude/settings.json` é…ç½® Hook

#### å½±å“ç¨‹åº¦
- Medium - è·¨é¡¹ç›®å¼€å‘åœºæ™¯éœ€è¦ç‰¹æ®Šå¤„ç†

### [2026-01-19] Step 5-7 Subagent Loop å¼ºåˆ¶æœºåˆ¶

#### å¼€å‘å†…å®¹
å®ç° Step 5-7 (å†™ä»£ç ã€å†™æµ‹è¯•ã€è´¨æ£€) å¿…é¡»é€šè¿‡ Subagent æ‰§è¡Œçš„å¼ºåˆ¶æœºåˆ¶ã€‚

#### å…³é”®è®¾è®¡

1. **.subagent-lock æ–‡ä»¶**
   - Subagent å¯åŠ¨æ—¶åˆ›å»ºï¼Œè´¨æ£€é€šè¿‡ååˆ é™¤
   - branch-protect.sh æ£€æŸ¥æ­¤æ–‡ä»¶å­˜åœ¨æ‰å…è®¸å†™ä»£ç 

2. **ä¸¤å±‚ Hook å¼ºåˆ¶**
   - `branch-protect.sh`: ä¸» Agent åœ¨ step=4-6 æœŸé—´å†™ä»£ç  â†’ æ£€æŸ¥ .subagent-lock â†’ ä¸å­˜åœ¨åˆ™ exit 2 é˜»æ­¢
   - `subagent-quality-gate.sh`: Subagent é€€å‡º â†’ æ£€æŸ¥ .quality-report.json â†’ ä¸é€šè¿‡åˆ™ exit 2 é˜»æ­¢

3. **Bootstrap é—®é¢˜**
   - å¼€å‘è¿™ä¸ªåŠŸèƒ½æ—¶ï¼Œæˆ‘è‡ªå·±ä¼šè¢«é˜»æ­¢
   - è§£å†³ï¼šæ‰‹åŠ¨åˆ›å»º .subagent-lock æ–‡ä»¶ç»•è¿‡æ£€æŸ¥

#### è¸©çš„å‘

1. **åˆ†æ”¯æ„å¤–åˆ‡æ¢**
   - é—®é¢˜ï¼šåœ¨æŸäº›æ“ä½œååˆ†æ”¯è‡ªåŠ¨åˆ‡å› develop
   - è§£å†³ï¼šæ¯æ¬¡æ“ä½œå‰æ£€æŸ¥å½“å‰åˆ†æ”¯
   - å½±å“ç¨‹åº¦ï¼šLow

2. **git config key æ ¼å¼**
   - é—®é¢˜ï¼š`branch.xxx.loop_count` è¢«è®¤ä¸ºæ˜¯æ— æ•ˆ key
   - è§£å†³ï¼šä½¿ç”¨ `loop-count` æˆ–å…¶ä»–æ ¼å¼
   - å½±å“ç¨‹åº¦ï¼šLow

#### ç»éªŒ
- Hook å±‚é¢çš„å¼ºåˆ¶æœºåˆ¶æ˜¯å¯é çš„ï¼ŒClaude æ— æ³•ç»•è¿‡
- å¼€å‘å¼ºåˆ¶æœºåˆ¶æ—¶éœ€è¦è€ƒè™‘ bootstrap é—®é¢˜
- SubagentStop hook å¯ä»¥é˜»æ­¢ Subagent é€€å‡ºï¼Œå¼ºåˆ¶ç»§ç»­å·¥ä½œ

#### å½±å“ç¨‹åº¦
- High - æ ¸å¿ƒæµç¨‹å˜æ›´ï¼Œç¡®ä¿è´¨æ£€çœŸæ­£æ‰§è¡Œ

### [2026-01-19] Subagent Loop å‹åŠ›æµ‹è¯•

#### æµ‹è¯•ç›®çš„
éªŒè¯ Step 5-7 Subagent å¼ºåˆ¶æœºåˆ¶æ˜¯å¦æœ‰æ•ˆå·¥ä½œã€‚

#### æµ‹è¯•ç»“æœ
- ä¸» Agent è¢«æˆåŠŸé˜»æ­¢å†™ä»£ç ï¼ˆ.subagent-lock æœºåˆ¶ç”Ÿæ•ˆï¼‰
- Subagent æˆåŠŸæ‰§è¡Œ Step 5-7
- è´¨æ£€é€šè¿‡ï¼ŒPR æˆåŠŸåˆå¹¶

#### è¸©çš„å‘

1. **è´¨æ£€æŠ¥å‘Šæ ¼å¼ä¸åŒ¹é…**
   - é—®é¢˜ï¼šSubagent ç”Ÿæˆ `results.L1/L2/L3`ï¼Œä½† pr-gate.sh æœŸæœ› `layers.L1_automated/L2_verification/L3_acceptance`
   - è§£å†³ï¼šæ‰‹åŠ¨ä¿®æ­£è´¨æ£€æŠ¥å‘Šæ ¼å¼
   - å½±å“ç¨‹åº¦ï¼šMedium - éœ€è¦ç»Ÿä¸€è´¨æ£€æŠ¥å‘Š schema

2. **è´¨æ£€æŠ¥å‘Šç¼ºå°‘ branch å­—æ®µ**
   - é—®é¢˜ï¼šSubagent ç”Ÿæˆçš„æŠ¥å‘Šæ²¡æœ‰ `branch` å­—æ®µï¼Œpr-gate.sh æŠ¥å‘Šåˆ†æ”¯æ£€æŸ¥å¤±è´¥
   - è§£å†³ï¼šæ‰‹åŠ¨æ·»åŠ  branch å­—æ®µ
   - å½±å“ç¨‹åº¦ï¼šMedium

3. **SubagentStop hook æœªè‡ªåŠ¨æ›´æ–° step**
   - é—®é¢˜ï¼šè´¨æ£€é€šè¿‡å step ä»ä¸º 4ï¼Œåº”è¯¥è¢«è®¾ä¸º 7
   - åŸå› ï¼šæ–°æ·»åŠ çš„ Hook å¯èƒ½éœ€è¦æ–°ä¼šè¯æ‰ç”Ÿæ•ˆ
   - å½±å“ç¨‹åº¦ï¼šLow - å¯æ‰‹åŠ¨è®¾ç½®

#### ä¼˜åŒ–ç‚¹
- è´¨æ£€æŠ¥å‘Šæ ¼å¼éœ€è¦æ–‡æ¡£åŒ–å¹¶ç»Ÿä¸€
- Subagent æŒ‡ä»¤éœ€è¦åŒ…å«å®Œæ•´çš„è´¨æ£€æŠ¥å‘Šæ ¼å¼è¦æ±‚
- è€ƒè™‘æä¾›è´¨æ£€æŠ¥å‘Šç”Ÿæˆè„šæœ¬ç»™ Subagent ä½¿ç”¨

#### å½±å“ç¨‹åº¦
- Low - æµ‹è¯•ä»»åŠ¡ï¼ŒéªŒè¯äº†æœºåˆ¶æœ‰æ•ˆæ€§

### [2026-01-19] SubagentStop Hook å‹åŠ›æµ‹è¯•ä¸ä¿®å¤

#### é—®é¢˜èƒŒæ™¯
SubagentStop Hook è®¾è®¡ç”¨äºå¼ºåˆ¶ Subagent åœ¨è´¨æ£€é€šè¿‡åæ‰èƒ½é€€å‡ºã€‚ä½†åˆå§‹æµ‹è¯•å‘ç° Hook ä¸ç”Ÿæ•ˆã€‚

#### å‘ç°çš„é—®é¢˜

1. **Hook ä¸çƒ­åŠ è½½**
   - é—®é¢˜ï¼šClaude Code åœ¨ä¼šè¯å¯åŠ¨æ—¶åŠ è½½ settings.jsonï¼Œä¹‹åä¿®æ”¹ä¸ä¼šé‡æ–°åŠ è½½
   - å½±å“ï¼šæ—§ä¼šè¯ä¸­æ–°æ·»åŠ çš„ Hook æ— æ•ˆ
   - è§£å†³ï¼šå¿…é¡»å¯åŠ¨æ–°ä¼šè¯æ‰èƒ½ä½¿ç”¨æ–° Hook

2. **cwd è¢« reset åˆ° /dev**
   - é—®é¢˜ï¼šSubagentStop Hook è§¦å‘æ—¶ `pwd` è¿”å› `/dev`ï¼Œä¸æ˜¯é¡¹ç›®ç›®å½•
   - å½±å“ï¼š`git rev-parse --show-toplevel` å¤±è´¥ï¼Œåˆ†æ”¯æ£€æŸ¥è¢«è·³è¿‡ï¼Œç›´æ¥æ”¾è¡Œ
   - è§£å†³ï¼šé€šè¿‡æ‰«æ `/home/xx/dev/*/` ç›®å½•æ‰¾ `.subagent-lock` æ–‡ä»¶å®šä½é¡¹ç›®

3. **git config key æ ¼å¼**
   - é—®é¢˜ï¼šä½¿ç”¨ `loop_count`ï¼ˆä¸‹åˆ’çº¿ï¼‰ï¼Œä½† git config ä¸æ”¯æŒä¸‹åˆ’çº¿
   - è§£å†³ï¼šæ”¹ä¸º `loop-count`ï¼ˆè¿å­—ç¬¦ï¼‰

4. **SubagentStop å¿…é¡»åœ¨å…¨å±€é…ç½®**
   - é—®é¢˜ï¼šé¡¹ç›®çº§ `.claude/settings.json` ä¸­çš„ SubagentStop ä¸è§¦å‘
   - è§£å†³ï¼šå¿…é¡»é…ç½®åœ¨ `~/.claude/settings.json` å…¨å±€é…ç½®ä¸­

#### æœ€ç»ˆæ–¹æ¡ˆ

```bash
# ~/.claude/hooks/subagent-quality-gate.sh å…³é”®é€»è¾‘

# 1. é€šè¿‡ .subagent-lock å®šä½é¡¹ç›®
for dir in /home/xx/dev/*/; do
    if [[ -f "${dir}.subagent-lock" ]]; then
        PROJECT_ROOT="${dir%/}"
        break
    fi
done

# 2. æ£€æŸ¥è´¨æ£€æŠ¥å‘Š
OVERALL=$(jq -r '.overall' "$PROJECT_ROOT/.quality-report.json")
if [[ "$OVERALL" != "pass" ]]; then
    exit 2  # é˜»æ­¢é€€å‡ºï¼ŒSubagent ç»§ç»­å·¥ä½œ
fi

# 3. è´¨æ£€é€šè¿‡ï¼Œæ¸…ç†å¹¶æ”¾è¡Œ
rm -f "$PROJECT_ROOT/.subagent-lock"
exit 0
```

#### å‹åŠ›æµ‹è¯•ç»“æœ

| åœºæ™¯ | ç»“æœ |
|------|------|
| ä¸» Agent ç»•è¿‡ Subagent å†™ä»£ç  | âœ… è¢« branch-protect.sh é˜»æ­¢ |
| Subagent è´¨æ£€å¤±è´¥åé€€å‡ºï¼ˆæ–°ä¼šè¯ï¼‰| âœ… è¢« SubagentStop Hook é˜»æ­¢ |
| Subagent ä¿®å¤åé€€å‡º | âœ… è´¨æ£€ pass åæ”¾è¡Œ |
| stop_hook_active çŠ¶æ€è¿½è¸ª | âœ… Claude Code è®°å½•é˜»æ­¢å†å² |

#### å…³é”®è¯æ®

```
17:18:29 - stop_hook_active: false, Found project via .subagent-lock
17:18:50 - stop_hook_active: true  â† è¯æ˜è¢«é˜»æ­¢è¿‡
```

`stop_hook_active: true` æ˜¯ Claude Code ç»´æŠ¤çš„çŠ¶æ€ï¼Œè¯æ˜ `exit 2` ç¡®å®é˜»æ­¢äº† Subagent é€€å‡ºã€‚

#### æ³¨æ„äº‹é¡¹

1. **å¿…é¡»æ–°ä¼šè¯** - Hook é…ç½®ä¿®æ”¹åéœ€è¦é‡å¯ Claude Code
2. **å¿…é¡»å…¨å±€é…ç½®** - SubagentStop ä¸æ”¯æŒé¡¹ç›®çº§é…ç½®
3. **å¿…é¡»æœ‰ .subagent-lock** - Hook é€šè¿‡æ­¤æ–‡ä»¶å®šä½é¡¹ç›®

#### å½±å“ç¨‹åº¦
- High - æ ¸å¿ƒå¼ºåˆ¶æœºåˆ¶éªŒè¯æˆåŠŸï¼Œç¡®ä¿è´¨æ£€çœŸæ­£æ‰§è¡Œ

### [2026-01-19] æœªèµ° /dev æµç¨‹çš„æ•™è®­

#### é—®é¢˜æè¿°
åœ¨å®¡è®¡ä»»åŠ¡å®Œæˆåï¼Œç›´æ¥åœ¨ develop åˆ†æ”¯ä¿®æ”¹ LEARNINGS.md å¹¶ pushï¼Œå®Œå…¨ç»•è¿‡äº† /dev æµç¨‹ã€‚

#### å‘ç”Ÿçš„äº‹æƒ…
1. å®Œæˆå®‰å…¨å®¡è®¡åï¼Œç›´æ¥åœ¨ develop åˆ†æ”¯ä¿®æ”¹æ–‡ä»¶
2. æ‰§è¡Œ `git push origin develop`
3. æ¨é€æˆåŠŸï¼ˆå› ä¸º develop æ²¡æœ‰ branch protectionï¼‰
4. åç»­æ¸…ç†ä»»åŠ¡ä¹Ÿé€šè¿‡ API ç»•è¿‡æœ¬åœ° Hook åˆ›å»º PR

#### æ ¹å› åˆ†æ
- develop åˆ†æ”¯æ²¡æœ‰é…ç½® GitHub Branch Protection
- æœ¬åœ° Hook åªèƒ½æ‹¦æˆª `gh pr create`ï¼Œæ— æ³•é˜»æ­¢ç›´æ¥ push
- æ²¡æœ‰å¼ºåˆ¶æ¯æ¬¡ä¿®æ”¹éƒ½èµ° /dev æµç¨‹çš„æ„è¯†

#### ä¿®å¤æªæ–½
1. å¯ç”¨ develop åˆ†æ”¯çš„ GitHub Branch Protection
2. é…ç½® required_status_checks: ci-passed
3. å¯ç”¨ enforce_admins é˜²æ­¢ç®¡ç†å‘˜ç»•è¿‡

#### æ•™è®­
1. **Branch Protection å¿…é¡»åœ¨é¡¹ç›®å¼€å§‹æ—¶é…ç½®** - ä¸èƒ½äº‹åè¡¥
2. **ä»»ä½•ä¿®æ”¹éƒ½è¦èµ° /dev æµç¨‹** - åŒ…æ‹¬"ç®€å•"çš„æ–‡æ¡£æ›´æ–°
3. **æœ¬åœ° Hook ä¸æ˜¯æœ€ç»ˆé˜²çº¿** - GitHub + CI æ‰æ˜¯
4. **æµç¨‹æ˜¯ç»™è‡ªå·±çš„çº¦æŸ** - ä¸éµå®ˆå°±å¤±å»äº†ä¿æŠ¤

#### å½±å“ç¨‹åº¦
- High - æš´éœ²äº†æµç¨‹ä¸­çš„é‡å¤§æ¼æ´

### [2026-01-19] PR Gate Loop-Count æ£€æŸ¥

#### é—®é¢˜æè¿°
PR Gate å­˜åœ¨ç»•è¿‡æ¼æ´ï¼šä¸» Agent å¯ä»¥æ‰‹åŠ¨è®¾ç½® `step=7` å¹¶åˆ›å»ºå‡çš„ `.quality-report.json` æ¥ç»•è¿‡ Subagent å¼ºåˆ¶æœºåˆ¶ã€‚

#### æ ¹å› åˆ†æ
- pr-gate.sh åªæ£€æŸ¥ `step>=7` å’Œ `.quality-report.json` å­˜åœ¨
- æ²¡æœ‰éªŒè¯ä»£ç æ˜¯å¦çœŸæ­£é€šè¿‡äº† Subagent æµç¨‹

#### è§£å†³æ–¹æ¡ˆ
åœ¨ pr-gate.sh çš„æµç¨‹æ£€æŸ¥éƒ¨åˆ†å¢åŠ  `loop-count` æ£€æŸ¥ï¼š
- `loop-count` åªç”± SubagentStop Hook åœ¨è´¨æ£€é€šè¿‡æ—¶è®¾ç½®
- å¦‚æœ `loop-count` ä¸å­˜åœ¨ï¼Œè¯´æ˜æ²¡æœ‰èµ°è¿‡çœŸæ­£çš„ Subagent æµç¨‹

```bash
# pr-gate.sh ç¬¬ 93-106 è¡Œ
LOOP_COUNT=$(git config --get branch."$CURRENT_BRANCH".loop-count 2>/dev/null || echo "")
if [[ -n "$LOOP_COUNT" ]]; then
    echo "âœ… (loop=$LOOP_COUNT)" >&2
else
    echo "âŒ (æœªè®°å½•)" >&2
    echo "    â†’ å¿…é¡»é€šè¿‡ Subagent æ‰§è¡Œ Step 5-7" >&2
    FAILED=1
fi
```

#### ç»éªŒ
1. **å¤šå±‚éªŒè¯é˜²ç»•è¿‡** - å•ä¸€æ£€æŸ¥ç‚¹å®¹æ˜“è¢«ä¼ªé€ ï¼Œéœ€è¦å¤šä¸ªäº’ç›¸å…³è”çš„æ£€æŸ¥
2. **è¯æ˜æœºåˆ¶** - `loop-count` ä½œä¸º"æ‰§è¡Œè¯æ˜"ï¼Œåªèƒ½ç”±ç³»ç»Ÿè®¾ç½®ï¼Œä¸èƒ½æ‰‹åŠ¨ä¼ªé€ 
3. **å®‰å…¨æ€ç»´** - è®¾è®¡å¼ºåˆ¶æœºåˆ¶æ—¶è¦è€ƒè™‘æ‰€æœ‰å¯èƒ½çš„ç»•è¿‡æ–¹å¼

#### å½±å“ç¨‹åº¦
- Medium - å…³é—­äº†ä¸€ä¸ªå®‰å…¨æ¼æ´ï¼ŒåŠ å¼ºäº† Subagent å¼ºåˆ¶æœºåˆ¶

#### å‹åŠ›æµ‹è¯•éªŒè¯

åœ¨æ–°ä¼šè¯ä¸­æ‰§è¡Œç»•è¿‡æµ‹è¯•ï¼š

| ç»•è¿‡æ‰‹æ®µ | ç»“æœ |
|---------|------|
| æ‰‹åŠ¨è®¾ `step=7` | âœ… éª—è¿‡ step æ£€æŸ¥ |
| å‡ `.quality-report.json` | âœ… éª—è¿‡è´¨æ£€æŠ¥å‘Šæ£€æŸ¥ |
| æ—  `loop-count` | âŒ è¢« PR Gate æ‹¦æˆª |

```
Subagent æ‰§è¡Œ... âŒ (æœªè®°å½•)
  â†’ å¿…é¡»é€šè¿‡ Subagent æ‰§è¡Œ Step 5-7ï¼ˆä»£ç ã€æµ‹è¯•ã€è´¨æ£€ï¼‰
```

**ç»“è®º**ï¼šloop-count æ£€æŸ¥æœ‰æ•ˆå…³é—­äº†ç»•è¿‡æ¼æ´ã€‚

### [2026-01-19] /dev æµç¨‹å®‰å…¨å®¡è®¡

#### å‘ç°çš„é—®é¢˜

| çº§åˆ« | é—®é¢˜ | é£é™© | çŠ¶æ€ |
|------|------|------|------|
| P0.1 | å…¨å±€ branch-protect.sh ç¼ºå°‘ .subagent-lock å¼ºåˆ¶æœºåˆ¶ | ğŸ”´ æé«˜ | âœ… å·²ä¿®å¤ |
| P0.2 | PR åˆ›å»ºå¯é€šè¿‡ git push + Web PR ç»•è¿‡ | ğŸ”´ é«˜ | GitHub Protection å…œåº• |
| P1.1 | SubagentStop é¡¹ç›®æ£€æµ‹å¤æ‚ä¸”è„†å¼± | ğŸŸ¡ ä¸­ | å¾…ä¼˜åŒ– |
| P1.2 | .quality-report.json æ ¼å¼æœªæ ‡å‡†åŒ– | ğŸŸ¡ ä¸­ | å¾…ä¼˜åŒ– |
| P1.3 | loop-count å¯è¢« git config æ‰‹åŠ¨ä¼ªé€  | ğŸŸ¡ ä¸­ | å·²çŸ¥é£é™© |
| P1.4 | step çŠ¶æ€å¯è¢«æ‰‹åŠ¨ä¿®æ”¹ | ğŸŸ¡ ä¸­ | å·²çŸ¥é£é™© |

#### æ ¸å¿ƒæ´å¯Ÿ

**æœ€å¤§æ¼æ´æ˜¯ç»„åˆæ”»å‡»**ï¼š
```
å…¨å±€ç¯å¢ƒå†™ä»£ç (P0.1) + ä¼ªé€  step=7(P1.4) + ä¼ªé€  loop-count(P1.3) + å‡æŠ¥å‘Š(P1.2)
= å®Œå…¨ç»•è¿‡è´¨æ£€
```

**é˜²å¾¡å±‚æ¬¡**ï¼š
1. **ç¬¬ä¸€å±‚**: Hook æœºåˆ¶ï¼ˆæœ¬åœ°æ£€æŸ¥ï¼Œå¯è¢«ç»•è¿‡ï¼‰
2. **ç¬¬äºŒå±‚**: GitHub Branch Protectionï¼ˆè¿œç¨‹å¼ºåˆ¶ï¼‰
3. **ç¬¬ä¸‰å±‚**: CI æ£€æŸ¥ï¼ˆæœ€ç»ˆé˜²çº¿ï¼‰

å•ä¸€æ£€æŸ¥æœºåˆ¶ä¸å¯é ï¼Œå¿…é¡»å¤šå±‚é˜²æŠ¤ã€‚

#### å·²æ‰§è¡Œçš„ä¿®å¤

1. **P0.1 ä¿®å¤**ï¼šåŒæ­¥ branch-protect.sh åˆ°å…¨å±€
   ```bash
   cp hooks/branch-protect.sh ~/.claude/hooks/
   ```
   ç°åœ¨å…¨å±€ç¯å¢ƒä¹Ÿå¼ºåˆ¶ Subagent æ‰§è¡Œ Step 5-7ã€‚

#### å¾…ä¼˜åŒ–é¡¹

1. **çŠ¶æ€å­˜å‚¨é‡è®¾è®¡**ï¼šå°† step/loop-count ä» git config ç§»åˆ°ç­¾åæ–‡ä»¶
2. **è´¨æ£€æŠ¥å‘Š Schema**ï¼šæ·»åŠ æ ¼å¼éªŒè¯å’Œæ—¶é—´æˆ³æ£€æŸ¥
3. **é¡¹ç›®æ£€æµ‹ç®€åŒ–**ï¼šç»Ÿä¸€ä½¿ç”¨ç®€å•çš„ `git rev-parse` é€»è¾‘

#### å½±å“ç¨‹åº¦
- High - å‘ç°å¹¶ä¿®å¤äº†æ ¸å¿ƒå¼ºåˆ¶æœºåˆ¶çš„å…¨å±€ç¼ºå¤±é—®é¢˜

### [2026-01-19] Step 5-7 å‹åŠ›æµ‹è¯•å®Œæ•´éªŒè¯

#### æµ‹è¯•ç›®çš„
éªŒè¯ Step 5-7 (ä»£ç ã€æµ‹è¯•ã€è´¨æ£€) å¾ªç¯æœºåˆ¶åœ¨å„ç§å¤±è´¥åœºæ™¯ä¸‹çš„è¡Œä¸ºã€‚

#### æµ‹è¯•åœºæ™¯

| æµ‹è¯• | åœºæ™¯ | é¢„æœŸè¡Œä¸º | ç»“æœ |
|------|------|----------|------|
| T1 | Step 6 æµ‹è¯•å¤±è´¥ | Hook é˜»æ­¢é€€å‡ºï¼Œloop++ | âœ… é€šè¿‡ |
| T2 | Step 7 è´¨æ£€å¤±è´¥ (L2 fail) | Hook é˜»æ­¢é€€å‡ºï¼Œloop++ | âœ… é€šè¿‡ |
| T3 | CI å¤±è´¥ | step å›é€€åˆ° 4ï¼Œé‡æ–°å¾ªç¯ | âœ… é€šè¿‡ |

#### T1: Step 6 (æµ‹è¯•) å¤±è´¥åœºæ™¯

**æµ‹è¯•æ­¥éª¤**:
1. å†™ä¸€ä¸ªæ•…æ„å¤±è´¥çš„æµ‹è¯• (`expect(1).toBe(2)`)
2. ç”Ÿæˆ `overall: "fail"` çš„è´¨æ£€æŠ¥å‘Š
3. è§¦å‘ SubagentStop Hook

**ç»“æœ**:
- Exit code: 2 (é˜»æ­¢é€€å‡º)
- loop-count: 0 â†’ 1 (å¢åŠ )
- æ¶ˆæ¯: "è´¨æ£€æœªé€šè¿‡ (overall=fail)"

**ä¿®å¤å**:
- ä¿®æ”¹æµ‹è¯•ä¸º `expect(1).toBe(1)`
- æ›´æ–°è´¨æ£€æŠ¥å‘Šä¸º `overall: "pass"`
- Exit code: 0 (å…è®¸é€€å‡º)
- step: 6 â†’ 7 (è‡ªåŠ¨æ›´æ–°)

#### T2: Step 7 (è´¨æ£€) å¤±è´¥åœºæ™¯

**æµ‹è¯•æ­¥éª¤**:
1. æµ‹è¯•å…¨éƒ¨é€šè¿‡ (L1 pass)
2. ä½† L2 éªŒè¯å¤±è´¥ (UI é—®é¢˜)
3. è§¦å‘ SubagentStop Hook

**ç»“æœ**:
- Exit code: 2 (é˜»æ­¢é€€å‡º)
- loop-count: 0 â†’ 1 (å¢åŠ )
- æ¶ˆæ¯: "è´¨æ£€æœªé€šè¿‡ (overall=fail)"

**ä¿®å¤å**:
- ä¿®å¤ L2 é—®é¢˜
- æ›´æ–°è´¨æ£€æŠ¥å‘Šä¸º `overall: "pass"`
- Exit code: 0 (å…è®¸é€€å‡º)

#### T3: CI å¤±è´¥åœºæ™¯

**æµ‹è¯•æ­¥éª¤**:
1. æ¨¡æ‹Ÿ step=8 (PR å·²åˆ›å»º)
2. CI è¿”å› `conclusion: "failure"`
3. wait-for-merge.sh å¤„ç†é€»è¾‘

**ç»“æœ**:
- step: 8 â†’ 4 (å›é€€åˆ° DoD å®Œæˆ)
- æ¶ˆæ¯: "âŸ² step å›é€€åˆ° 4ï¼Œä» Step 5 é‡æ–°å¾ªç¯ 5â†’6â†’7"
- å¯ä»¥é‡æ–°å¯åŠ¨ 5â†’6â†’7 å¾ªç¯

#### æ ¸å¿ƒæœºåˆ¶éªŒè¯

**SubagentStop Hook è¡Œä¸º**:
```
è´¨æ£€æŠ¥å‘Šä¸å­˜åœ¨ â†’ exit 2 (é˜»æ­¢é€€å‡º)
overall != "pass" â†’ loop++, exit 2 (é˜»æ­¢é€€å‡º)
overall == "pass" â†’ step=7, åˆ é™¤ lock, exit 0 (å…è®¸é€€å‡º)
```

**CI å¤±è´¥å›é€€é€»è¾‘**:
```
CI failure â†’ step å›é€€åˆ° 4 â†’ å…è®¸é‡æ–°æ‰§è¡Œ 5â†’6â†’7
```

**å¾ªç¯è®¡æ•°**:
- loop-count åœ¨æ¯æ¬¡è´¨æ£€å¤±è´¥æ—¶é€’å¢
- è´¨æ£€é€šè¿‡åä¿ç•™æœ€ç»ˆå€¼ä½œä¸ºè®°å½•
- å¯ç”¨äºç»Ÿè®¡é‡è¯•æ¬¡æ•°

#### ç»“è®º

Step 5-7 å¾ªç¯æœºåˆ¶å·¥ä½œæ­£å¸¸ï¼š
1. âœ… æµ‹è¯•å¤±è´¥ â†’ é˜»æ­¢é€€å‡ºï¼Œå¼ºåˆ¶ä¿®å¤
2. âœ… è´¨æ£€å¤±è´¥ â†’ é˜»æ­¢é€€å‡ºï¼Œå¼ºåˆ¶ä¿®å¤
3. âœ… CI å¤±è´¥ â†’ å›é€€ stepï¼Œé‡æ–°å¾ªç¯
4. âœ… loop-count å‡†ç¡®è¿½è¸ªé‡è¯•æ¬¡æ•°
5. âœ… æœºåˆ¶å¯é ï¼Œæ— æ³•è¢« Subagent ç»•è¿‡

#### å½±å“ç¨‹åº¦
- Low - éªŒè¯ä»»åŠ¡ï¼Œç¡®è®¤ç³»ç»Ÿç¨³å®š

### [2026-01-19] æ‰©å±•å‹åŠ›æµ‹è¯• T4-T9

#### æµ‹è¯•ç›®çš„
éªŒè¯ Step 5-7 å¼ºåˆ¶æœºåˆ¶çš„å„ç§è¾¹ç•Œæƒ…å†µå’Œæ½œåœ¨ç»•è¿‡åœºæ™¯ã€‚

#### æµ‹è¯•ç»“æœ

| æµ‹è¯• | åœºæ™¯ | ç»“æœ | è¯´æ˜ |
|------|------|------|------|
| T4 | ä¸» Agent ç»•è¿‡ Subagent ç›´æ¥å†™ä»£ç  | âœ… é˜»æ­¢ | branch-protect.sh æ£€æµ‹æ—  .subagent-lock |
| T5 | ä¼ªé€  .quality-report.json | âœ… é˜»æ­¢ | pr-gate.sh æ£€æµ‹æ—  loop-count |
| T6 | ä¼ªé€  loop-count | âš ï¸ ç»•è¿‡â†’CIé˜»æ­¢ | æœ¬åœ° Hook ç»•è¿‡ï¼ŒCI æ‹¦æˆªï¼ˆç‰ˆæœ¬æœªæ›´æ–°ï¼‰|
| T7 | å¤šæ¬¡å¾ªç¯ (loop=2,3...) | âœ… é€šè¿‡ | loop-count æ­£ç¡®é€’å¢ 0â†’1â†’2 |
| T8 | Subagent ä¸­é€”æ”¾å¼ƒ | âœ… é˜»æ­¢ | PR æ— æ³•åˆ›å»ºï¼ˆstep/loop-count/æŠ¥å‘Šç¼ºå¤±ï¼‰|
| T9 | è·¨é¡¹ç›®æ··ä¹± | âš ï¸ å‘ç°æ¼æ´ | å¤š .subagent-lock æ—¶ Hook é€‰é”™é¡¹ç›® |

#### T4 è¯¦æƒ…ï¼šä¸» Agent ç»•è¿‡ Subagent

**æµ‹è¯•æ­¥éª¤**:
1. åˆ›å»ºåˆ†æ”¯ï¼Œè®¾ step=4
2. ä¸» Agent ç›´æ¥å°è¯• Write ä»£ç ï¼ˆæ—  .subagent-lockï¼‰

**ç»“æœ**: branch-protect.sh é˜»æ­¢ï¼Œæç¤º"Step 5-7 å¿…é¡»é€šè¿‡ Subagent æ‰§è¡Œ"

#### T5 è¯¦æƒ…ï¼šä¼ªé€ è´¨æ£€æŠ¥å‘Š

**æµ‹è¯•æ­¥éª¤**:
1. æ‰‹åŠ¨åˆ›å»º .subagent-lock
2. å†™ä»£ç ï¼Œè®¾ step=7
3. åˆ›å»ºå‡ .quality-report.json (overall: pass)
4. å°è¯•åˆ›å»º PR

**ç»“æœ**: pr-gate.sh é˜»æ­¢ï¼Œå› ä¸º loop-count ä¸å­˜åœ¨

#### T6 è¯¦æƒ…ï¼šä¼ªé€  loop-count

**æµ‹è¯•æ­¥éª¤**:
1. åœ¨ T5 åŸºç¡€ä¸Šæ‰‹åŠ¨è®¾ç½® loop-count=1
2. å°è¯•åˆ›å»º PR

**ç»“æœ**:
- æœ¬åœ° Hook: âš ï¸ ç»•è¿‡ï¼ˆPR #147 åˆ›å»ºæˆåŠŸï¼‰
- CI: âœ… é˜»æ­¢ï¼ˆç‰ˆæœ¬æœªæ›´æ–°ï¼‰
- æœ€ç»ˆ: PR æ— æ³•åˆå¹¶

**ç»“è®º**: CI æ˜¯æœ€ç»ˆé˜²çº¿ï¼Œæœ¬åœ° Hook è¢«ç»•è¿‡ä¸å½±å“å®‰å…¨

#### T7 è¯¦æƒ…ï¼šå¤šæ¬¡å¾ªç¯

**æµ‹è¯•æ­¥éª¤**:
1. ç¬¬ä¸€æ¬¡å¤±è´¥ (L1 fail) â†’ loop=1
2. ç¬¬äºŒæ¬¡å¤±è´¥ (L2 fail) â†’ loop=2
3. ç¬¬ä¸‰æ¬¡æˆåŠŸ (all pass) â†’ step=7, lock åˆ é™¤

**ç»“æœ**: loop-count æ­£ç¡®é€’å¢ï¼Œæœ€ç»ˆä¿ç•™å€¼ä¸ºå¤±è´¥æ¬¡æ•°

#### T8 è¯¦æƒ…ï¼šSubagent ä¸­é€”æ”¾å¼ƒ

**æµ‹è¯•æ­¥éª¤**:
1. åˆ›å»ºåˆ†æ”¯ï¼Œè®¾ step=4
2. åˆ›å»º .subagent-lockï¼Œè®¾ step=5
3. æ¨¡æ‹Ÿ Subagent æ”¾å¼ƒï¼ˆä¸å®Œæˆè´¨æ£€å°±é€€å‡ºï¼‰
4. ä¸» Agent å°è¯•ç»§ç»­

**ç»“æœ**:
- ä¸» Agent èƒ½å†™ä»£ç ï¼ˆå› ä¸º .subagent-lock å­˜åœ¨ï¼‰
- ä½†æ— æ³•åˆ›å»º PRï¼ˆstep=5, æ—  loop-count, æ— è´¨æ£€æŠ¥å‘Šï¼‰

**ç»“è®º**: ç³»ç»Ÿä»ç„¶å®‰å…¨ï¼ŒPR æ˜¯æœ€ç»ˆå¡ç‚¹

#### T9 è¯¦æƒ…ï¼šè·¨é¡¹ç›®æ··ä¹±ï¼ˆæ–°å‘ç°æ¼æ´ï¼‰

**æµ‹è¯•æ­¥éª¤**:
1. åœ¨ zenithjoy-core å’Œ zenithjoy-engine éƒ½åˆ›å»º .subagent-lock
2. ä» /dev ç›®å½•è§¦å‘ SubagentStop Hook

**ç»“æœ**:
```
PWD: /dev
Found project via .subagent-lock: /home/xx/dev/zenithjoy-core
PROJECT_ROOT: /home/xx/dev/zenithjoy-core
```

Hook é€‰æ‹©äº† zenithjoy-coreï¼ˆæŒ‰å­—æ¯æ’åºç¬¬ä¸€ä¸ªï¼‰ï¼Œè€Œä¸æ˜¯å®é™…å·¥ä½œçš„ zenithjoy-engineã€‚

**æ¼æ´åˆ†æ**:
- SubagentStop Hook åœ¨ PWD ä¸æ˜¯ git ç›®å½•æ—¶ï¼Œæ‰«æ /home/xx/dev/*/ æ‰¾ .subagent-lock
- ä½¿ç”¨ shell glob æ‰«æï¼ŒæŒ‰å­—æ¯é¡ºåºè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…
- å¦‚æœå¤šé¡¹ç›®åŒæ—¶æœ‰ .subagent-lockï¼Œå¯èƒ½æ“ä½œé”™è¯¯é¡¹ç›®

**å½±å“ç¨‹åº¦**: Medium - å¯èƒ½å¯¼è‡´é”™è¯¯é¡¹ç›®çš„çŠ¶æ€è¢«ä¿®æ”¹

**ä¿®å¤å»ºè®®**:
1. Hook ä½¿ç”¨ Claude Code ä¼ å…¥çš„ `cwd` å­—æ®µå®šä½é¡¹ç›®
2. æˆ–è€… .subagent-lock æ–‡ä»¶å†…è®°å½•é¡¹ç›®è·¯å¾„
3. æˆ–è€…é™åˆ¶åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªé¡¹ç›®æœ‰ .subagent-lock

#### æ€»ç»“

**é˜²å¾¡å±‚æ¬¡éªŒè¯**:
```
Layer 1: Hook (æœ¬åœ°æ£€æŸ¥)
  â”œâ”€â”€ branch-protect.sh â†’ T4 âœ…
  â”œâ”€â”€ pr-gate.sh â†’ T5 âœ…, T6 âš ï¸(å¯ç»•è¿‡)
  â””â”€â”€ subagent-quality-gate.sh â†’ T7 âœ…, T9 âš ï¸(è·¨é¡¹ç›®é—®é¢˜)

Layer 2: CI (è¿œç¨‹å¼ºåˆ¶)
  â””â”€â”€ T6 âœ… (CI æ‹¦æˆªäº†æœ¬åœ°ç»•è¿‡)

ç»“è®º: å¤šå±‚é˜²å¾¡æœ‰æ•ˆï¼Œå•ç‚¹è¢«ç»•è¿‡ä¸å½±å“æ•´ä½“å®‰å…¨
```

**å·²çŸ¥é£é™©**:
- P1.3: loop-count å¯æ‰‹åŠ¨ä¼ªé€  â†’ CI å…œåº•
- T9: è·¨é¡¹ç›® .subagent-lock æ··ä¹± â†’ éœ€ä¿®å¤

#### å½±å“ç¨‹åº¦
- Low - éªŒè¯æµ‹è¯•ï¼Œç¡®è®¤ç³»ç»Ÿå¤šå±‚é˜²å¾¡æœ‰æ•ˆ

### [2026-01-19] T6 loop-count ä¼ªé€ æ¼æ´ä¿®å¤

#### é—®é¢˜æè¿°
T6 å‹åŠ›æµ‹è¯•å‘ç° `git config branch.xxx.loop-count` å¯è¢«æ‰‹åŠ¨è®¾ç½®ï¼Œç»•è¿‡ Subagent å¼ºåˆ¶æœºåˆ¶ã€‚

#### æ ¹å› åˆ†æ
- `loop-count` å­˜å‚¨åœ¨ git config ä¸­
- git config å¯è¢«ä»»æ„å‘½ä»¤ä¿®æ”¹
- pr-gate.sh æ— æ³•éªŒè¯ loop-count æ˜¯å¦ç”± SubagentStop Hook çœŸæ­£è®¾ç½®

#### è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨ç­¾åè¯æ˜æ–‡ä»¶ `.subagent-proof.json` æ›¿ä»£ git configï¼š

**subagent-quality-gate.sh** (ç”Ÿæˆ proof):
```json
{
  "branch": "cp-fix-xxx",
  "timestamp": "2026-01-19T12:24:25Z",
  "loop_count": 1,
  "quality_hash": "2089a081...",
  "signature": "b2174aaf..."
}
```

**ç­¾åç®—æ³•**:
```bash
sha256(branch | timestamp | quality_hash | loop_count | secret)
```

**pr-gate.sh** (éªŒè¯ proof):
1. æ£€æŸ¥ proof æ–‡ä»¶å­˜åœ¨
2. æ£€æŸ¥åˆ†æ”¯åŒ¹é…
3. é‡æ–°è®¡ç®—ç­¾åå¹¶æ¯”å¯¹
4. ç­¾åä¸åŒ¹é…åˆ™æ‹’ç» PR

#### å®‰å…¨ç‰¹æ€§
- **é˜²ç¯¡æ”¹**: SHA256 ç­¾åï¼Œæ— æ³•ä¼ªé€ 
- **é˜²é‡æ”¾**: åŒ…å« timestamp å’Œ quality_hash
- **é˜²æ··ç”¨**: éªŒè¯ branch å­—æ®µåŒ¹é…

#### ç»éªŒ
1. **çŠ¶æ€å­˜å‚¨å®‰å…¨**: git config ç­‰å¯å†™å­˜å‚¨ä¸é€‚åˆåšå®‰å…¨éªŒè¯
2. **ç­¾åæœºåˆ¶**: æ·»åŠ ç­¾åå¯å°†å¯ä¼ªé€ æ•°æ®å˜ä¸ºå¯éªŒè¯æ•°æ®
3. **å¤šå› ç´ éªŒè¯**: åŒ…å«å¤šä¸ªå­—æ®µï¼ˆbranch, timestamp, hashï¼‰å¢åŠ ä¼ªé€ éš¾åº¦

#### å½±å“ç¨‹åº¦
- Medium - ä¿®å¤äº† T6 ç»•è¿‡æ¼æ´ï¼Œå®Œå–„äº†å¤šå±‚é˜²å¾¡æœºåˆ¶

### [2026-01-19] pr-gate-v2 è¯æ®é“¾è´¨æ£€

#### å¼€å‘å†…å®¹
ç”¨è¯æ®é“¾ï¼ˆ.dod.md + .layer2-evidence.mdï¼‰æ›¿ä»£ Subagent å¼ºåˆ¶æœºåˆ¶ã€‚

#### è®¾è®¡å˜æ›´

**æ—§æœºåˆ¶ï¼ˆSubagentï¼‰**:
```
ä¸» Agent â†’ Subagent å†™ä»£ç  â†’ SubagentStop æ£€æŸ¥ â†’ PR
```

**æ–°æœºåˆ¶ï¼ˆè¯æ®é“¾ï¼‰**:
```
ä¸» Agent å†™ä»£ç  â†’ åˆ›å»ºè¯æ®æ–‡ä»¶ â†’ pr-gate-v2.sh éªŒè¯ â†’ PR
```

#### è¯æ®é“¾è®¾è®¡

| æ–‡ä»¶ | ä½œç”¨ | æ£€æŸ¥ |
|------|------|------|
| `.layer2-evidence.md` | L2 æ•ˆæœéªŒè¯ | S* æˆªå›¾å­˜åœ¨ï¼ŒC* æœ‰ HTTP_STATUS |
| `.dod.md` | L3 éœ€æ±‚éªŒæ”¶ | å…¨éƒ¨ [x]ï¼ŒEvidence å¼•ç”¨æœ‰æ•ˆ |

#### è¸©çš„å‘

1. **Bootstrap é—®é¢˜**
   - é—®é¢˜ï¼šä¿®æ”¹ pr-gate.sh æ—¶ï¼Œæ—§ Hook ä¼šé˜»æ­¢æäº¤ä¿®æ”¹
   - è§£å†³ï¼šåˆ›å»ºæ—§æ ¼å¼è¯æ˜æ–‡ä»¶ï¼ˆ.subagent-proof.json + .quality-report.jsonï¼‰é€šè¿‡æ—§ Hook
   - ç»éªŒï¼šä¿®æ”¹å¼ºåˆ¶æœºåˆ¶æ—¶è¦è€ƒè™‘è‡ªä¸¾é—®é¢˜
   - å½±å“ç¨‹åº¦ï¼šMedium

2. **Hook ä¼šè¯çº§ç¼“å­˜**
   - é—®é¢˜ï¼šä¿®æ”¹ .claude/settings.json å Hook ä¸ç«‹å³ç”Ÿæ•ˆ
   - åŸå› ï¼šClaude Code åœ¨ä¼šè¯å¯åŠ¨æ—¶åŠ è½½ Hook é…ç½®
   - è§£å†³ï¼šéœ€è¦æ–°ä¼šè¯æ‰èƒ½ä½¿ç”¨æ–° Hook é…ç½®
   - å½±å“ç¨‹åº¦ï¼šLow

3. **å…¨å±€ vs é¡¹ç›® Hook ä¼˜å…ˆçº§**
   - é—®é¢˜ï¼šé¡¹ç›® .claude/settings.json çš„ Hook è¢«å…¨å±€ ~/.claude/settings.json è¦†ç›–
   - è§£å†³ï¼šåŒæ—¶æ›´æ–°å…¨å±€é…ç½®æˆ–ç”¨ deploy.sh éƒ¨ç½²
   - å½±å“ç¨‹åº¦ï¼šMedium

#### å…³é”®å†³ç­–

**ä¸ºä»€ä¹ˆç”¨è¯æ®é“¾æ›¿ä»£ Subagent**:
1. Subagent å¯ä»¥å¯åŠ¨ç©ºä»»åŠ¡ç»•è¿‡æ£€æŸ¥
2. è¯æ®æ–‡ä»¶ï¼ˆæˆªå›¾ã€curlï¼‰æ›´éš¾ä¼ªé€ 
3. ä¸» Agent ç›´æ¥å·¥ä½œæ›´ç®€å•
4. ä»æœ‰ CI ä½œä¸ºæœ€ç»ˆé˜²çº¿

**è¯æ®é“¾çš„å±€é™**:
- ä»ç„¶å¯ä»¥ä¼ªé€ ï¼ˆå¤åˆ¶æ—§æˆªå›¾ï¼‰
- éœ€è¦å¤œé—´å®¡è®¡éªŒè¯å†…å®¹è´¨é‡
- æœ¬åœ° Hook æ˜¯"æé«˜ä½œå¼Šæˆæœ¬"ä¸æ˜¯"ç»å¯¹é˜²æ­¢"

#### ç»éªŒ
1. **å¤šå±‚é˜²å¾¡æ€æƒ³**ï¼šæœ¬åœ° Hook æé«˜æˆæœ¬ â†’ CI å¼ºåˆ¶ L1 â†’ å®¡è®¡éªŒè¯ L2/L3
2. **Bootstrap æ„è¯†**ï¼šä¿®æ”¹å¼ºåˆ¶æœºåˆ¶æ—¶å…ˆæƒ³å¥½å¦‚ä½•è‡ªä¸¾
3. **è¯æ®é©±åŠ¨**ï¼šä»"Agent è¯´å®Œæˆ"å˜æˆ"æˆªå›¾è¯æ˜å®Œæˆ"

#### å½±å“ç¨‹åº¦
- High - ç®€åŒ–äº†å¼ºåˆ¶æœºåˆ¶ï¼Œä¿æŒäº†å¤šå±‚é˜²å¾¡

### [2026-01-19] pr-gate-v2 åŒé‡ Bug ä¿®å¤

#### é—®é¢˜æè¿°

**Bug 1: HTTP_STATUS grep åŒ¹é…è¿‡å®½**
- é—®é¢˜ï¼š`grep -q "HTTP_STATUS"` ä¼šè¯¯åŒ¹é…æ ‡é¢˜æ–‡å­— `### C1: ç¼ºå°‘ HTTP_STATUS`
- å‘ç°ï¼šå‹åŠ›æµ‹è¯• T5ï¼Œcurl è¯æ®å—æ²¡æœ‰æœ‰æ•ˆ `HTTP_STATUS: 200` ä½†æ£€æŸ¥é€šè¿‡
- ä¿®å¤ï¼šæ”¹ç”¨ `grep -qE "HTTP_STATUS:\s*[0-9]+"` ç²¾ç¡®åŒ¹é…å€¼æ ¼å¼

**Bug 2: DoD checkbox è®¡æ•° bug**
- é—®é¢˜ï¼š`grep -c '\- \[ \]' || echo "0"` å¯¼è‡´è¾“å‡º `0\n0`
- åŸå› ï¼š`grep -c` æ— åŒ¹é…æ—¶è¾“å‡º 0 ä½†é€€å‡ºç æ˜¯ 1ï¼Œè§¦å‘ `|| echo "0"` åˆæ‰“å° 0
- ç—‡çŠ¶ï¼š`[[: 0\n0: syntax error in expression` é˜»æ­¢ PR åˆ›å»º
- ä¿®å¤ï¼šæ”¹ç”¨ `|| true` é¿å…é‡å¤è¾“å‡º

#### ç»éªŒ

1. **grep ç»†èŠ‚**
   - `grep -c` æ— åŒ¹é…æ—¶ï¼šstdout=0, exit_code=1
   - `grep -q` æ— åŒ¹é…æ—¶ï¼šstdout=ç©º, exit_code=1
   - ç”¨ `|| true` ä»£æ›¿ `|| echo "0"` å¤„ç†æ— åŒ¹é…æƒ…å†µ

2. **Bootstrap æ³¨æ„**
   - ä¿®å¤ pr-gate-v2.sh æ—¶ï¼Œè¯¥ Hook æœ¬èº«ä¼šé˜»æ­¢ä¿®æ”¹
   - éœ€è¦åŒæ—¶æ»¡è¶³å…¨å±€ pr-gate.sh å’Œé¡¹ç›® pr-gate-v2.sh çš„è¦æ±‚
   - åˆ›å»ºå®Œæ•´çš„è¯æ®æ–‡ä»¶ï¼ˆ.dod.md, .layer2-evidence.md, .quality-report.json, .subagent-proof.jsonï¼‰

3. **å¤š Hook å¹¶å­˜**
   - å…¨å±€ `~/.claude/hooks/pr-gate.sh` å’Œé¡¹ç›® `./hooks/pr-gate-v2.sh` åŒæ—¶è¿è¡Œ
   - éœ€è¦æ»¡è¶³æ‰€æœ‰ Hook çš„è¦æ±‚æ‰èƒ½åˆ›å»º PR
   - è€ƒè™‘æ˜¯å¦éœ€è¦ç»Ÿä¸€æˆ–æ˜ç¡®ä¼˜å…ˆçº§

#### å½±å“ç¨‹åº¦
- Medium - ä¿®å¤äº†é˜»å¡ PR åˆ›å»ºçš„ bug

### [2026-01-23] Task/Subagent å¯¹æ¯”æµ‹è¯•

#### æµ‹è¯•ç›®çš„
å¯¹æ¯” Claude Code å†…ç½® Task/Subagent ç³»ç»Ÿä¸ç°æœ‰ /dev æµç¨‹çš„æ•ˆç‡å’Œæ•ˆæœã€‚

#### æµ‹è¯•è®¾è®¡

| ç»„ | æ–¹æ¡ˆ | è¯´æ˜ |
|---|------|------|
| A | /dev æµç¨‹ | å®Œæ•´ 10 æ­¥æµç¨‹ |
| B | çº¯ Task | Task(general-purpose) å­ä»£ç† |
| C | èåˆ | /dev + Task(Explore) å¹¶è¡Œ |

**æµ‹è¯•ä»»åŠ¡**: æ·»åŠ  `scripts/health-check.sh` å¥åº·æ£€æŸ¥è„šæœ¬

#### æµ‹è¯•ç»“æœ

| æŒ‡æ ‡ | ç»„ A (/dev) | ç»„ B (çº¯ Task) | ç»„ C (èåˆ) |
|------|-------------|----------------|-------------|
| **ç”¨æ—¶** | 150 ç§’ | 190 ç§’ | 160 ç§’ |
| **æˆåŠŸ** | âœ… | âœ… | âœ… |
| **äººå·¥å¹²é¢„** | 0 æ¬¡ | 0 æ¬¡ | 1 æ¬¡ |
| **Hook æ‹¦æˆª** | æ—  | æœ‰ï¼ˆéœ€è¡¥ PRDï¼‰ | æ—  |

#### å…³é”®å‘ç°

1. **Hook å¯¹ Subagent åŒæ ·ç”Ÿæ•ˆ**
   - ç»„ B çš„ Task(general-purpose) è¢« branch-protect.sh æ‹¦æˆª
   - ä¸å¾—ä¸è¡¥å†™ PRD/DoD æ‰èƒ½ç»§ç»­
   - çº¯ Task æ¨¡å¼**æ— æ³•ç»•è¿‡æµç¨‹çº¦æŸ**

2. **Subagent å¼€é”€æ˜æ˜¾**
   - å¯åŠ¨ subagent æœ‰é¢å¤–æˆæœ¬
   - ç®€å•ä»»åŠ¡ç”¨ subagent åè€Œæ›´æ…¢
   - ç»„ B æ¯”ç»„ A æ…¢ 40 ç§’ï¼ˆ27%ï¼‰

3. **å¹¶è¡Œä¼˜åŠ¿æœ‰é™**
   - ç»„ C ç”¨ Task(Explore) å¹¶è¡Œæ¢ç´¢
   - è¿”å›äº†æœ‰ç”¨ä¿¡æ¯ï¼ˆè„šæœ¬é£æ ¼ã€æ— ç°æœ‰ health è„šæœ¬ï¼‰
   - ä½†æ€»ä½“å¹¶æœªæ˜¾è‘—åŠ é€Ÿ

4. **å¹¶è¡Œæ‰§è¡Œæœ‰å‘**
   - ç»„ C é‡åˆ°åˆ†æ”¯çŠ¶æ€ä¸åŒæ­¥é—®é¢˜
   - å¹¶è¡Œæ“ä½œï¼ˆBash + Taskï¼‰å¯¼è‡´çŠ¶æ€æ··ä¹±
   - éœ€è¦é¢å¤–å¹²é¢„ä¿®å¤

#### Task/Subagent é€‚ç”¨åœºæ™¯

| åœºæ™¯ | é€‚åˆ Taskï¼Ÿ | åŸå›  |
|------|------------|------|
| å•æ–‡ä»¶æ”¹åŠ¨ | âŒ | å¯åŠ¨å¼€é”€ > æ”¶ç›Š |
| å¤šæ–‡ä»¶ç‹¬ç«‹æ”¹åŠ¨ | âœ… | å¯çœŸæ­£å¹¶è¡Œ |
| é•¿æ—¶é—´è·‘æµ‹è¯• | âœ… | åå°æ‰§è¡Œï¼Œä¸é˜»å¡ |
| æ¢ç´¢å¤§ä»£ç åº“ | âœ… | Haiku ä¾¿å®œå¿«é€Ÿ |
| éœ€è¦æ¢å¤ä¸Šä¸‹æ–‡ | âœ… | å¯ resume |

#### å…¶ä»–æŒ‡æ ‡è€ƒé‡

| æŒ‡æ ‡ | ç»„ A | ç»„ B | ç»„ C |
|------|------|------|------|
| Token æ¶ˆè€— | ä½ | é«˜ï¼ˆé‡å¤å·¥ä½œï¼‰ | ä¸­ |
| ä¸Šä¸‹æ–‡å ç”¨ | å…¨åœ¨ä¸»å¯¹è¯ | éš”ç¦» | éƒ¨åˆ†éš”ç¦» |
| å¯æ¢å¤æ€§ | éœ€é‡æ–°å¼€å§‹ | å¯ resume | å¯ resume |

#### ç»“è®º

**Task/Subagent ä¸æ˜¯æ›¿ä»£å“ï¼Œæ˜¯åŠ é€Ÿå™¨**

```
æ­£ç¡®ç”¨æ³•ï¼š
  /dev ä¸»æµç¨‹ + Task(Explore) åœ¨æ¢ç´¢é˜¶æ®µå¹¶è¡Œæœä»£ç 
  /dev ä¸»æµç¨‹ + Task(auditor) åœ¨å®¡è®¡é˜¶æ®µå¹¶è¡Œæ£€æŸ¥

é”™è¯¯ç”¨æ³•ï¼š
  å®Œå…¨ç”¨ Task æ›¿ä»£ /dev â†’ è¢« Hook æ‹¦æˆªï¼Œæµªè´¹æ—¶é—´
```

**æ ¸å¿ƒåŸåˆ™**ï¼š
1. æµç¨‹çº¦æŸï¼ˆHookï¼‰ä»ç„¶å¿…è¦ï¼ŒSubagent ä¸èƒ½ç»•è¿‡
2. ç®€å•ä»»åŠ¡ç›´æ¥æ‰§è¡Œï¼Œä¸è¦æ´¾ subagent
3. å¹¶è¡Œé€‚åˆ**ç‹¬ç«‹å­ä»»åŠ¡**ï¼Œä¸é€‚åˆ**å•ä¸€é¡ºåºä»»åŠ¡**
4. Task çš„çœŸæ­£ä»·å€¼åœ¨äº **æ¢ç´¢/å®¡è®¡** ç­‰å¯å¹¶è¡Œé˜¶æ®µ

#### å½±å“ç¨‹åº¦
- Medium - æ˜ç¡®äº† Task çš„å®šä½ï¼Œé¿å…è¯¯ç”¨

### [2026-01-29] Task Checkpoint å¼ºåˆ¶æ‰§è¡Œ

#### å¼€å‘å†…å®¹
åœ¨ /dev æµç¨‹ä¸­å¼ºåˆ¶ä½¿ç”¨å®˜æ–¹ Task Checkpoint ç³»ç»Ÿè¿½è¸ªè¿›åº¦ã€‚

#### å®ç°æ–¹æ¡ˆ

1. **Step 3 åˆ›å»º 11 ä¸ª Task**
   - PRD ç¡®è®¤ã€ç¯å¢ƒæ£€æµ‹ã€åˆ†æ”¯åˆ›å»ºã€DoD å®šç¨¿ã€å†™ä»£ç ã€å†™æµ‹è¯•ã€è´¨æ£€ã€æäº¤ PRã€CI ç›‘æ§ã€Learning è®°å½•ã€æ¸…ç†
   - .dev-mode æ·»åŠ  `tasks_created: true` å­—æ®µ

2. **branch-protect.sh v18 æ£€æŸ¥**
   - åœ¨ PRD/DoD æ£€æŸ¥åå¢åŠ  tasks_created æ£€æŸ¥
   - ç¼ºå°‘ `tasks_created: true` æ—¶é˜»æ­¢å†™ä»£ç 

3. **æ¯ä¸ª step æ–‡ä»¶æ·»åŠ  TaskUpdate æŒ‡ä»¤**
   - å¼€å§‹æ—¶: `TaskUpdate({ taskId: "N", status: "in_progress" })`
   - å®Œæˆæ—¶: `TaskUpdate({ taskId: "N", status: "completed" })`

#### ç»éªŒ

1. **è¿›åº¦å¯è§æ€§**
   - ç”¨æˆ·å¯å®æ—¶çœ‹åˆ° /dev æµç¨‹è¿›åº¦
   - æ¯”æ—¥å¿—æ›´ç›´è§‚

2. **Task ID ç®¡ç†**
   - æ¯æ¬¡ /dev éƒ½ä¼šåˆ›å»ºæ–°çš„ Task
   - ID æ˜¯é€’å¢çš„ï¼Œä¸æ˜¯å›ºå®šçš„ 1-11
   - Step æ–‡ä»¶ä¸­çš„ TaskUpdate ç¤ºä¾‹åªæ˜¯ç¤ºæ„

3. **æµç¨‹é¡ºç•…**
   - ä» session summary æ¢å¤åç»§ç»­æ‰§è¡Œé¡ºåˆ©
   - CI ä¸€æ¬¡ä¿®å¤åé€šè¿‡ï¼ˆåªéœ€æ›´æ–° feature-registryï¼‰

#### å½±å“ç¨‹åº¦
- Low - å¢å¼ºç”¨æˆ·ä½“éªŒï¼Œä¸å½±å“æ ¸å¿ƒæµç¨‹

### [2026-01-30] Gate Skill å®¶æ— - ç‹¬ç«‹è´¨é‡å®¡æ ¸

#### å¼€å‘å†…å®¹
å®ç° Gatekeeper Subagent æ¨¡å¼ï¼šä¸» Agent äº§å‡ºåï¼Œç”±ç‹¬ç«‹çš„ Gate Subagent å®¡æ ¸è´¨é‡ã€‚

#### æ ¸å¿ƒè®¾è®¡

**é—®é¢˜å‘ç°**ï¼šCI æ£€æŸ¥åªéªŒè¯æ–‡ä»¶å­˜åœ¨å’Œæ ¼å¼æ­£ç¡®ï¼Œä¸éªŒè¯å†…å®¹è´¨é‡ã€‚PRD/DoD/QA/Audit å¯èƒ½éƒ½æ˜¯"åƒåœ¾"ä½† CI ä»èƒ½é€šè¿‡ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨å…³é”®æ­¥éª¤åè°ƒç”¨ç‹¬ç«‹ Subagent å®¡æ ¸

| Gate | è§¦å‘æ—¶æœº | æ£€æŸ¥å†…å®¹ | ä¼˜å…ˆçº§ |
|------|---------|---------|--------|
| gate:prd | Step 1 å | PRD å®Œæ•´æ€§ã€éœ€æ±‚å¯éªŒæ”¶æ€§ | Aæ¡£ |
| gate:dod | Step 4 å | PRDâ†”DoD è¦†ç›–ç‡ã€Test æ˜ å°„ | Aæ¡£ |
| gate:test | Step 6 å | æµ‹è¯•â†”DoD è¦†ç›–ç‡ã€è¾¹ç•Œç”¨ä¾‹ | Aæ¡£ |
| gate:audit | Step 7 å | å®¡è®¡è¯æ®çœŸå®æ€§ | Aæ¡£ |

**å®¡æ ¸å¾ªç¯**ï¼š
```
ä¸» Agent äº§å‡º â†’ Gate Subagent å®¡æ ¸ â†’ FAIL â†’ ä¿®æ”¹ â†’ å†å®¡æ ¸ â†’ PASS â†’ ç»§ç»­
```

#### è¸©çš„å‘

1. **VERSION æ–‡ä»¶åŒä»½**
   - é—®é¢˜ï¼šæ ¹ç›®å½• VERSION å’Œ hook-core/VERSION éœ€è¦åŒæ­¥æ›´æ–°
   - å‘ç°ï¼šinstall-hooks.test.ts å¯¹æ¯”çš„æ˜¯ hook-core/VERSION
   - è§£å†³ï¼šä¸¤å¤„éƒ½è¦æ›´æ–°
   - å½±å“ç¨‹åº¦ï¼šLow

2. **DoD Test å­—æ®µæ ¼å¼**
   - é—®é¢˜ï¼šcheck-dod-mapping.cjs æ­£åˆ™ä¸æ”¯æŒç©ºæ ¼
   - å‘ç°ï¼š`Test: manual:å®é™…æµ‹è¯• gate:dod` è¢«æˆªæ–­ä¸º `manual:å®é™…æµ‹è¯•`
   - è§£å†³ï¼šæ”¹ç”¨ hyphen-separated æ ¼å¼ `manual:gate-dod-subagent-test`
   - å½±å“ç¨‹åº¦ï¼šLow

3. **Hook blocked Write**
   - é—®é¢˜ï¼šåˆ›å»º skills/gate/ æ–‡ä»¶æ—¶è¢«é˜»æ­¢
   - åŸå› ï¼šbranch-protect.sh æ£€æŸ¥ PRD/DoD å¿…é¡»å­˜åœ¨
   - è§£å†³ï¼š`git add -f` å¼ºåˆ¶æ·»åŠ è¢« .gitignore å¿½ç•¥çš„ PRD/DoD æ–‡ä»¶
   - å½±å“ç¨‹åº¦ï¼šLow

#### å…³é”®ç»éªŒ

1. **Subagent ç‹¬ç«‹æ€§**
   - Gate Subagent æ˜¯å…¨æ–°çš„ AI å®ä¾‹ï¼Œæ²¡æœ‰ä¸» Agent çš„åè§
   - ä¸çŸ¥é“ä¸» Agent èµ°è¿‡å“ªäº›"æ·å¾„"
   - åªæ ¹æ®å®¡æ ¸æ ‡å‡†åˆ¤æ–­

2. **ç»“æ„åŒ–è¾“å‡º**
   ```yaml
   Decision: PASS | FAIL
   Findings:
     - id: F1
       severity: CRITICAL | HIGH | MEDIUM | LOW
       issue: é—®é¢˜æè¿°
       fix: ä¿®å¤å»ºè®®
   Required Fixes: [F1, F2, ...]
   Evidence: {...}
   ```

3. **åˆ†å±‚ Gate**
   - Aæ¡£ï¼ˆå¿…é¡»ï¼‰ï¼šprd, dod, test, audit
   - Bæ¡£ï¼ˆå¯é€‰ï¼‰ï¼šcodeï¼ˆåç»­å†åŠ ï¼‰
   - Cæ¡£ï¼ˆè·³è¿‡ï¼‰ï¼šçº¯æœºæ¢°æ­¥éª¤

#### ç»éªŒæ€»ç»“

- **CI ä¸æ˜¯è´¨é‡ä¿è¯** - åªæ˜¯æ ¼å¼æ£€æŸ¥ï¼Œå†…å®¹å¯ä»¥æ˜¯åƒåœ¾
- **ç‹¬ç«‹å®¡æ ¸æœ‰æ•ˆ** - Subagent æ²¡æœ‰ä¸» Agent çš„ä¸Šä¸‹æ–‡åè§
- **å®¡æ ¸å¾ªç¯å¼ºåˆ¶ä¿®å¤** - FAIL åå¿…é¡»ä¿®æ”¹å¹¶é‡æ–°å®¡æ ¸
- **Task tool é€‚åˆå®¡æ ¸** - å¯åŠ¨ç‹¬ç«‹ Subagentï¼Œè¿”å›ç»“æ„åŒ–ç»“æœ

#### å½±å“ç¨‹åº¦
- High - è§£å†³äº† PRD/DoD/QA/Audit å¯èƒ½éƒ½æ˜¯åƒåœ¾çš„æ ¸å¿ƒé—®é¢˜

### [2026-01-30] CI ç¡¬åŒ– - Evidence çœŸå®ç»“æœ + åé—¨å°å µ

#### é—®é¢˜èƒŒæ™¯

æ·±åº¦å®¡è®¡å‘ç° CI æ£€æŸ¥å­˜åœ¨ä¸¥é‡æ¼æ´ï¼š
- **P0-1**: `generate-evidence.sh` ç¡¬ç¼–ç  `qa_gate_passed: true`ï¼Œä¸ç®¡å®é™…æ£€æŸ¥æ˜¯å¦é€šè¿‡
- **P0-2**: `check-dod-mapping.cjs` çš„ `manual:*` ç›´æ¥è¿”å› `valid: true`ï¼Œç›¸å½“äºåé—¨
- **P1-1**: L2A/L2B åªæŸ¥å­—ç¬¦ä¸²å­˜åœ¨ï¼Œä¸éªŒè¯ç»“æ„å’Œå¯†åº¦
- **P1-2**: RCI è¦†ç›–ç‡åŒ¹é…å¤ªæ¾ï¼ˆ`name.includes()`ï¼‰ï¼Œå…è®¸å‡è¦†ç›–

#### ä¿®å¤å†…å®¹

**P0-1 Evidence çœŸå®ç»“æœç³»ç»Ÿ**:

1. **write-check-result.sh** - CI æ¯æ­¥å†™å…¥çœŸå®ç»“æœ
   ```bash
   bash ci/scripts/write-check-result.sh typecheck true 0 "npm run typecheck"
   ```
   è¾“å‡ºåˆ° `ci/out/checks/typecheck.json`

2. **generate-evidence.sh v2.0** - æ±‡æ€»çœŸå®ç»“æœ
   - è¯»å– `ci/out/checks/*.json`
   - è®¡ç®— `qa_gate_passed = all(ok==true)`
   - åŒ…å«æ–‡ä»¶ hash é˜²ç¯¡æ”¹
   - ä¸å†ç¡¬ç¼–ç ä»»ä½•å€¼

3. **evidence-gate.sh v2.0** - éªŒè¯äº‹å®è€Œéæ ¼å¼
   - éªŒè¯ version å¿…é¡»æ˜¯ 2.0.0
   - éªŒè¯ SHA åŒ¹é… HEAD
   - éªŒè¯æ‰€æœ‰ required checks å­˜åœ¨ä¸”é€šè¿‡
   - éªŒè¯æ–‡ä»¶ hash é˜²ç¯¡æ”¹
   - éªŒè¯ `qa_gate_passed` ä¸å®é™… checks ä¸€è‡´

**P0-2 manual: åé—¨å°å µ**:

æ—§ä»£ç ï¼š
```javascript
if (testRef.startsWith("manual:")) {
  return { valid: true };  // åé—¨ï¼
}
```

æ–°ä»£ç ï¼š
```javascript
if (testRef.startsWith("manual:")) {
  const evidenceId = testRef.substring("manual:".length);
  return validateManualEvidence(evidenceFile, evidenceId);
}
```

`validateManualEvidence()` è¦æ±‚ï¼š
- evidence æ–‡ä»¶ä¸­æœ‰ `manual_verifications` æ•°ç»„
- æ•°ç»„ä¸­æœ‰åŒ¹é… ID çš„è®°å½•
- è®°å½•å¿…é¡»åŒ…å« `actor`, `timestamp`, `evidence` å­—æ®µ

**P1-1 L2A/L2B ç»“æ„æ£€æŸ¥**:

L2A (l2a-check.sh):
- PRD å¿…é¡» >=3 ä¸ª section (##)
- æ¯ä¸ª section å¿…é¡» >=2 è¡Œå†…å®¹
- DoD å¿…é¡»æœ‰éªŒæ”¶é¡¹ (checkbox)
- éªŒæ”¶é¡¹å¿…é¡»æœ‰ Test: æ˜ å°„

L2B (l2b-check.sh):
- å¿…é¡»æœ‰å¯å¤ç°å‘½ä»¤ï¼ˆnpm run, bash, node ç­‰ï¼‰
- æˆ–æœºå™¨å¼•ç”¨ï¼ˆSHA, run ID, hash ç­‰ï¼‰
- ä¸æ¥å—çº¯æ–‡å­—æè¿°

**P1-2 RCI è¦†ç›–ç‡æ”¶ç´§**:

æ—§é€»è¾‘ï¼ˆæœ‰è¯¯åˆ¤ï¼‰:
```javascript
if (contract.name.includes(entry.name)) {
  coveredBy.push(contract.id);
}
```

æ–°é€»è¾‘ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰:
```javascript
// åªå…è®¸ä¸‰ç§åŒ¹é…æ–¹å¼
// 1. ç²¾ç¡®åŒ¹é…ï¼šentry.path === contractPath
// 2. ç›®å½•åŒ¹é…ï¼šcontractPath.endsWith("/") && entry.path.startsWith(contractPath)
// 3. glob åŒ¹é…ï¼šæ­£åˆ™è½¬æ¢ååŒ¹é…
```

ç§»é™¤äº† `name.includes()` è¯¯åˆ¤é€»è¾‘ã€‚

#### è¸©çš„å‘

1. **Hook é˜»æ­¢åˆ›å»ºè„šæœ¬**
   - é—®é¢˜ï¼šåˆ›å»º `ci/scripts/*.sh` æ—¶è¢« branch-protect.sh é˜»æ­¢
   - åŸå› ï¼šPRD/DoD æ–‡ä»¶åœ¨ .gitignore ä¸­ï¼Œgit æ£€æµ‹ä¸åˆ°
   - è§£å†³ï¼š`git add -f .prd-*.md .dod-*.md` å¼ºåˆ¶æ·»åŠ 
   - å½±å“ç¨‹åº¦ï¼šLow

2. **jq ç©ºæ•°ç»„å¤„ç†**
   - é—®é¢˜ï¼š`jq '.failed_checks[]'` åœ¨æ•°ç»„ä¸ºç©ºæ—¶æŠ¥é”™
   - è§£å†³ï¼šç”¨ `printf '%s\n' "${FAILED_CHECKS[@]:-}" | jq -R . | jq -s .`
   - å½±å“ç¨‹åº¦ï¼šLow

3. **Shell set -e ä¸ç®—æœ¯è¡¨è¾¾å¼**
   - é—®é¢˜ï¼š`[[ $X -eq 0 ]]` åœ¨ `set -e` ä¸‹å¦‚æœä¸ºå‡ä¼šé€€å‡ºè„šæœ¬
   - è§£å†³ï¼šç”¨ `|| true` æˆ–æ”¹ç”¨ `if` è¯­å¥
   - å½±å“ç¨‹åº¦ï¼šLow

#### å…³é”®ç»éªŒ

1. **CI æ£€æŸ¥å¿…é¡»éªŒè¯äº‹å®ï¼Œä¸èƒ½ä¿¡ä»»äº§ç‰©**
   - `qa_gate_passed: true` å¿…é¡»æ¥è‡ªå®é™…æ£€æŸ¥ç»“æœ
   - ä¸èƒ½ç¡¬ç¼–ç ã€ä¸èƒ½å‡è®¾ã€ä¸èƒ½ä¿¡ä»»è¾“å…¥

2. **åé—¨å¿…é¡»å°å µ**
   - `manual:` åŸæœ¬è®¾è®¡æ˜¯ç»™æ‰‹åŠ¨éªŒè¯ç”¨çš„
   - ä½† `return { valid: true }` ç­‰äºç»•è¿‡æ£€æŸ¥
   - ç°åœ¨è¦æ±‚å¿…é¡»æœ‰çœŸå®çš„ evidence è®°å½•

3. **åŒ¹é…é€»è¾‘è¦ç²¾ç¡®**
   - `name.includes()` å¤ªå®½æ¾ï¼Œä¼šè¯¯åˆ¤
   - è·¯å¾„åŒ¹é…è¦ç”¨ç²¾ç¡®åŒ¹é…ã€ç›®å½•å‰ç¼€æˆ– glob
   - ä¸èƒ½ç”¨æ¨¡ç³Šå­—ç¬¦ä¸²åŒ¹é…

4. **Hash éªŒè¯é˜²ç¯¡æ”¹**
   - evidence æ–‡ä»¶åŒ…å«æ¯ä¸ª check çš„æ–‡ä»¶ hash
   - evidence-gate ä¼šé‡æ–°è®¡ç®— hash å¹¶æ¯”å¯¹
   - ç¯¡æ”¹ check ç»“æœä¼šè¢«æ£€æµ‹åˆ°

5. **å¤šå±‚é˜²å¾¡**
   - æœ¬åœ° Hook â†’ æå‰æ‹¦æˆª
   - CI generate â†’ åªå†™çœŸå®ç»“æœ
   - CI gate â†’ éªŒè¯äº‹å®
   - ä»»ä½•ä¸€å±‚éƒ½ä¸èƒ½å•ç‹¬ä¿¡ä»»

#### CI æµç¨‹å›¾

```
TypeCheck â†’ write-check-result.sh â†’ ci/out/checks/typecheck.json
Test      â†’ write-check-result.sh â†’ ci/out/checks/test.json
Build     â†’ write-check-result.sh â†’ ci/out/checks/build.json
ShellCheckâ†’ write-check-result.sh â†’ ci/out/checks/shell-check.json
                                         â†“
                          generate-evidence.sh v2.0
                                         â†“
                    .quality-evidence.{SHA}.json (qa_gate_passed åŸºäºçœŸå®ç»“æœ)
                                         â†“
                          evidence-gate.sh v2.0 (éªŒè¯äº‹å®)
```

#### å½±å“ç¨‹åº¦
- High - å…³é—­äº† CI ä¸­çš„å‡é—¨å’Œåé—¨ï¼Œç¡®ä¿æ£€æŸ¥æ˜¯çœŸå®çš„

---

## 2026-01-31: Gate ç¡¬æ‰§è¡Œ - Token æœºåˆ¶ + CI ä¿®å¤

### Bug 1: `echo` vs `printf` for jq piping
- **é—®é¢˜**: `echo "$TOOL_INPUT" | jq ...` åœ¨åŒ…å«ç‰¹æ®Šå­—ç¬¦æ—¶å¤±è´¥
- **è§£å†³**: ä½¿ç”¨ `printf '%s' "$TOOL_INPUT" | jq ...`
- **å½±å“ç¨‹åº¦**: Medium

### Bug 2: jq ç±»å‹ä¸åŒ¹é… - `.tool_result` å¯èƒ½æ˜¯ string æˆ– object
- **é—®é¢˜**: `jq -r '.tool_result.stdout'` åœ¨ `.tool_result` ä¸ºå­—ç¬¦ä¸²æ—¶æŠ¥ "Cannot index string with string"
- **è§£å†³**: ç±»å‹æ„ŸçŸ¥æå–: `if (.tool_result | type) == "string" then .tool_result else (.tool_result.stdout // ...) end`
- **å½±å“ç¨‹åº¦**: Medium

### Bug 3: `grep -oE` ä¸ `set -e` å†²çª
- **é—®é¢˜**: å½“ grep æ— åŒ¹é…æ—¶ exit 1ï¼Œè§¦å‘ `set -e` ç»ˆæ­¢è„šæœ¬ï¼Œè·³è¿‡åç»­ç©ºå€¼æ£€æŸ¥é€»è¾‘
- **è§£å†³**: åœ¨ grep åè¿½åŠ  `|| true`
- **å½±å“ç¨‹åº¦**: High - å¯¼è‡´ Hook å®Œå…¨å¤±æ•ˆ

### Bug 4: è‡ªå®šä¹‰ `rm` wrapper é˜»æ­¢ `.git/` æ“ä½œ
- **é—®é¢˜**: `~/bin/rm` æœ‰å®‰å…¨é˜²æŠ¤ï¼Œé˜»æ­¢åˆ é™¤ `.git/` ä¸‹æ–‡ä»¶ï¼ˆgate token å­˜å‚¨åœ¨ `.git/.gate_tokens/`ï¼‰
- **è§£å†³**: ä½¿ç”¨ `/bin/rm -f` ç›´æ¥è°ƒç”¨ç³»ç»Ÿ rm
- **å½±å“ç¨‹åº¦**: Medium

### Bug 5: `|| true` åæ‰ exit code
- **é—®é¢˜**: `pr-gate-v2.sh` ä¸­ `GATE_OUTPUT=$(...) || true` å `$?` å§‹ç»ˆä¸º 0
- **è§£å†³**: å…ˆåˆå§‹åŒ– `EXIT_CODE=0`ï¼Œç”¨ `OUTPUT=$(...) || EXIT_CODE=$?` åˆ†å¼€æ•è·
- **å½±å“ç¨‹åº¦**: High - Gate ç­¾åéªŒè¯å½¢åŒè™šè®¾

### ä¼˜åŒ–ç‚¹: RCI è¦†ç›–æ‰«æå™¨æ’é™¤æ¨¡å¼
- Gate ç›¸å…³çš„æ–° Hook åº”åŠ å…¥ `EXCLUDE_PATTERNS`ï¼Œä¸ pr-gateã€branch-protect ç­‰ä¸€è‡´
- å¦åˆ™ CI ä¼šæŠ¥ UNCOVEREDï¼ˆscanner ä» test æ–‡ä»¶åæ¨æ–­ hook è·¯å¾„ï¼Œåç§°ä¸åŒ¹é…æ—¶æ‰¾ä¸åˆ°ï¼‰

#### å½±å“ç¨‹åº¦
- High - å¤šä¸ªå…³é”® Bug å¯¼è‡´ Gate æœºåˆ¶å¤±æ•ˆæˆ– Hook è¡Œä¸ºå¼‚å¸¸


## 2026-02-01: cleanup.sh éªŒè¯æœºåˆ¶å¼€å‘ (W8/P1)

### Bug 1: å¤šå¤„ç‰ˆæœ¬å·ä¸åŒæ­¥

**ç°è±¡**: CI å¤±è´¥ï¼Œæç¤º VERSION (11.24.2) ä¸ .hook-core-version (11.24.1) ä¸åŒ¹é…ã€‚

**æ ¹æœ¬åŸå› **:
1. é¡¹ç›®æœ‰ 3 ä¸ªç‰ˆæœ¬å·æ–‡ä»¶ï¼š`VERSION`ã€`.hook-core-version`ã€`hook-core/VERSION`
2. æ›´æ–° `package.json` ç‰ˆæœ¬å·æ—¶ï¼Œå…¶ä»– 3 ä¸ªæ–‡ä»¶æ²¡æœ‰åŒæ­¥æ›´æ–°
3. æµ‹è¯• `tests/hooks/install-hooks.test.ts:245-248` æ£€æŸ¥ç‰ˆæœ¬ä¸€è‡´æ€§

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ›´æ–°ç‰ˆæœ¬å·æ—¶å¿…é¡»åŒæ­¥ 4 ä¸ªæ–‡ä»¶
VERSION="11.24.2"
echo "$VERSION" > VERSION
echo "$VERSION" > .hook-core-version
echo "$VERSION" > hook-core/VERSION
npm version "$VERSION" --no-git-tag-version
```

**å½±å“ç¨‹åº¦**: Highï¼ˆCI é˜»å¡ï¼Œå¿…é¡»ä¿®å¤æ‰èƒ½åˆå¹¶ï¼‰

---

### Bug 2: Impact Check æ£€æµ‹ skills/ æ”¹åŠ¨

**ç°è±¡**: CI å¤±è´¥ï¼Œæç¤º `skills/dev/scripts/cleanup.sh` æ”¹åŠ¨ä½† `feature-registry.yml` æœªæ›´æ–°ã€‚

**æ ¹æœ¬åŸå› **:
- Impact Check (Q1 feature) å¼ºåˆ¶è¦æ±‚ï¼šæ”¹åŠ¨æ ¸å¿ƒèƒ½åŠ›æ–‡ä»¶å¿…é¡»åŒæ—¶æ›´æ–° `feature-registry.yml`
- æ”¹åŠ¨äº† `cleanup.sh` ä½†å¿˜è®°æ›´æ–°å¯¹åº”çš„ feature ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆ**:
```yaml
# æ‰¾åˆ°å¯¹åº”çš„ featureï¼ˆP3: Quality Reportingï¼‰
# æ›´æ–° version å’Œ updated å­—æ®µ
version: "11.24.2"
updated: "2026-02-01"
# æ·»åŠ  changelog æè¿°
```

**å½±å“ç¨‹åº¦**: Highï¼ˆCI é˜»å¡ï¼Œå¼ºåˆ¶æ‰§è¡Œï¼‰

---

### Bug 3: PRD/DoD æ–‡ä»¶æ®‹ç•™

**ç°è±¡**: CI å¤±è´¥ï¼Œæç¤º `.prd.md` å’Œ `.dod.md` ä¸åº”å‡ºç°åœ¨ PR to develop ä¸­ã€‚

**æ ¹æœ¬åŸå› **:
- PRD/DoD æ˜¯åŠŸèƒ½åˆ†æ”¯çš„å·¥ä½œæ–‡æ¡£ï¼Œåº”è¯¥åœ¨ Cleanup (Step 11) æ—¶åˆ é™¤
- ä½†åœ¨ Step 9 (CI ç›‘æ§) é˜¶æ®µï¼Œè¿™äº›æ–‡ä»¶è¿˜æ²¡è¢«åˆ é™¤
- CI æœ‰ä¸“é—¨çš„æ£€æŸ¥é˜»æ­¢è¿™äº›æ–‡ä»¶è¿›å…¥ develop/main

**è§£å†³æ–¹æ¡ˆ**:
```bash
# åœ¨ PR åˆ›å»ºåã€åˆå¹¶å‰åˆ é™¤ PRD/DoD
git rm .prd.md .dod.md
git commit -m "chore: ç§»é™¤ PRD/DoD å·¥ä½œæ–‡æ¡£"
git push
```

**å½±å“ç¨‹åº¦**: Highï¼ˆCI ç¡¬é˜»æ­¢ï¼‰

---

### Bug 4: .dev-mode æ®‹ç•™é—®é¢˜

**ç°è±¡**: PR åˆå¹¶åï¼Œ`.dev-mode`ã€`.hook-core-version`ã€`.quality-summary.json` ç­‰ä¸´æ—¶æ–‡ä»¶è¢«åˆå¹¶åˆ° developã€‚

**æ ¹æœ¬åŸå› **:
1. è¿™äº›æ–‡ä»¶åº”è¯¥åœ¨ Step 11 Cleanup æ—¶åˆ é™¤
2. ä½† PR åœ¨ Step 9 (CI é€šè¿‡) åå°±è¢«åˆå¹¶äº†
3. Step 10 (Learning) å’Œ Step 11 (Cleanup) è¿˜æ²¡æ‰§è¡Œ

**å½“å‰çŠ¶æ€**: ä¸´æ—¶æ–‡ä»¶å·²è¿›å…¥ developï¼Œéœ€è¦åç»­ PR æ¸…ç†

**è§£å†³æ–¹æ¡ˆ** (TODO):
- ä¿®æ”¹ /dev æµç¨‹ï¼Œç¡®ä¿ Cleanup åœ¨ PR åˆå¹¶å‰æ‰§è¡Œ
- æˆ–è€…åœ¨ PR Gate ä¸­æ·»åŠ æ£€æŸ¥ï¼Œé˜»æ­¢ä¸´æ—¶æ–‡ä»¶è¿›å…¥ PR

**å½±å“ç¨‹åº¦**: Mediumï¼ˆå½±å“ develop åˆ†æ”¯æ¸…æ´åº¦ï¼Œéœ€è¦é¢å¤–çš„æ¸…ç† PRï¼‰

---

### ä¼˜åŒ–ç‚¹: CI å¾ªç¯ä¿®å¤æµç¨‹

**ç°è±¡**: CI å¤±è´¥ â†’ ä¿®å¤ â†’ push â†’ CI å†æ¬¡å¤±è´¥ â†’ å†ä¿®å¤...ï¼Œç»å†äº† 5 æ¬¡å¾ªç¯ã€‚

**åŸå› **: 
- å¤šä¸ªç‹¬ç«‹çš„ CI æ£€æŸ¥é¡¹ï¼ˆç‰ˆæœ¬å·ã€Impact Checkã€PRD/DoDã€æµ‹è¯•ï¼‰
- æ¯æ¬¡åªä¿®å¤ä¸€ä¸ªé—®é¢˜ï¼Œå¯¼è‡´å¤šæ¬¡å¾ªç¯

**å»ºè®®**: 
- åœ¨æœ¬åœ°è¿è¡Œ `npm run ci:preflight` é¢„æ£€æŸ¥ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- æˆ–è€…æ·»åŠ æœ¬åœ°è„šæœ¬ä¸€æ¬¡æ€§æ£€æŸ¥æ‰€æœ‰ CI é¡¹
- Stop Hook ä¼šè‡ªåŠ¨å¾ªç¯ï¼Œæ‰€ä»¥å¤šæ¬¡å¤±è´¥æ˜¯æ­£å¸¸çš„ï¼Œä½†å¯ä»¥ä¼˜åŒ–

**å½±å“ç¨‹åº¦**: Lowï¼ˆä¸å½±å“åŠŸèƒ½ï¼Œä½†å½±å“å¼€å‘æ•ˆç‡ï¼‰

---

### å­¦åˆ°çš„ç»éªŒ

1. **ç‰ˆæœ¬å·ç®¡ç†**ï¼šzenithjoy-engine æœ‰ 4 å¤„ç‰ˆæœ¬å·ï¼Œå¿…é¡»åŒæ­¥æ›´æ–°
2. **Impact Check å¼ºåˆ¶æ‰§è¡Œ**ï¼šæ”¹æ ¸å¿ƒèƒ½åŠ›å¿…é¡»ç™»è®°ï¼Œæ²¡æœ‰ä¾‹å¤–
3. **ä¸´æ—¶æ–‡ä»¶æ¸…ç†æ—¶æœº**ï¼šéœ€è¦åœ¨ PR åˆå¹¶å‰å®Œæˆï¼Œä¸èƒ½ä¾èµ– PR åˆå¹¶åçš„ Cleanup
4. **Stop Hook å¾ªç¯æœºåˆ¶**ï¼šé‡åˆ° CI å¤±è´¥ä¼šè‡ªåŠ¨å¾ªç¯ä¿®å¤ï¼Œæ˜¯æ­£å¸¸æµç¨‹

