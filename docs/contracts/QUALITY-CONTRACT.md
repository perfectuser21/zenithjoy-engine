---
id: quality-contract
version: 2.0.0
created: 2026-01-24
updated: 2026-01-24
changelog:
  - 2.0.0: è´¨é‡å¥‘çº¦ - ä¸‰å¥—åˆ†å±‚ç³»ç»Ÿ + å¼ºåˆ¶é¡¹å®šä¹‰
---

# Quality Contract - è´¨é‡å¥‘çº¦

**è´¨é‡çœŸæº** - å®šä¹‰æœ¯è¯­è¡¨ã€å¼ºåˆ¶é¡¹ã€æœ¬åœ° vs CI æ£€æŸ¥è¾¹ç•Œã€‚

> **æ ¸å¿ƒåŸåˆ™ï¼ˆP0 Anti-Bypassï¼‰**ï¼š
> - æœ¬åœ° Hooks = åŠ é€Ÿå¤±è´¥ï¼ˆæå‰å‘ç°é—®é¢˜ï¼‰
> - è¿œç«¯ CI + Branch Protection = æœ€ç»ˆå¼ºåˆ¶ï¼ˆç‰©ç†é˜»æ­¢åˆå¹¶ï¼‰

---

## P0 è´¨æ£€å¼ºåˆ¶ä¸‰ä»¶å¥—ï¼ˆv10.1.0+ï¼‰

### P0-1: Impact Checkï¼ˆèƒ½åŠ›å˜æ›´å¼ºåˆ¶ç™»è®°ï¼‰

**ç›®æ ‡**ï¼šæ”¹äº†æ ¸å¿ƒèƒ½åŠ›æ–‡ä»¶ï¼Œå¿…é¡»åŒæ—¶æ›´æ–°èƒ½åŠ›æ³¨å†Œè¡¨

**è§¦å‘æ¡ä»¶**ï¼šPR æ”¹åŠ¨ä»¥ä¸‹ä»»æ„è·¯å¾„æ—¶
- `hooks/`
- `skills/`
- `scripts/detect-phase.sh`
- `scripts/qa-with-gate.sh`
- `features/`

**å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»åŒæ—¶æ”¹åŠ¨ `features/feature-registry.yml`

**å®ç°**ï¼š
- CI job: `impact-check`
- è„šæœ¬: `scripts/devgate/impact-check.sh`

**å‰å‘ä¸€è‡´æ€§**ï¼š
- æ”¹èƒ½åŠ› â†’ å¿…é¡»ç™»è®° âœ…
- æ”¹ç™»è®° â†’ å…è®¸ï¼ˆä¸è¦æ±‚æ”¹èƒ½åŠ›ï¼‰âœ…ï¼ˆå…è®¸æ–‡æ¡£æ›´æ–°ï¼‰

---

### P0-2: Evidence Gateï¼ˆè´¨æ£€è¯æ®é—¨æ§ï¼‰

**ç›®æ ‡**ï¼šè´¨æ£€é€šè¿‡ä¸é å£å¤´ï¼Œè¦æœ‰æœºå™¨å¯éªŒçš„è¯æ®æ–‡ä»¶

**è¯æ®æ–‡ä»¶**ï¼š`.quality-evidence.json`

**ç”Ÿæˆæ—¶æœº**ï¼š`npm run qa:gate` æˆåŠŸåè‡ªåŠ¨ç”Ÿæˆ

**æ ¼å¼**ï¼š
```json
{
  "sha": "<current HEAD>",
  "branch": "<branch>",
  "qa_gate_passed": true,
  "audit_decision": "PASS",
  "timestamp": "2026-01-24T21:03:56+08:00",
  "evidence": {
    "typecheck": "passed",
    "tests": "186/186 passed",
    "build": "success",
    "audit_l1": 0,
    "audit_l2": 0
  }
}
```

**CI éªŒè¯**ï¼š
- CI job: `evidence-gate`
- æ£€æŸ¥é¡¹ï¼š
  - [ ] æ–‡ä»¶å¿…é¡»å­˜åœ¨
  - [ ] JSON å­—æ®µé½å…¨
  - [ ] `sha == HEAD`ï¼ˆé˜²è€æ–‡ä»¶å†’ç”¨ï¼‰âš ï¸ å…³é”®
  - [ ] `qa_gate_passed == true`
  - [ ] `audit_decision == "PASS"`

**å®ç°**ï¼š
- ç”Ÿæˆ: `scripts/qa-with-gate.sh` æœ«å°¾è‡ªåŠ¨ç”Ÿæˆ
- éªŒè¯: CI job `evidence-gate`
- Git: `.gitignore` ä¸å¿½ç•¥æ­¤æ–‡ä»¶ï¼ˆ`!.quality-evidence.json`ï¼‰

---

### P0-3: Anti-Bypass å£å¾„ï¼ˆè¿œç«¯å¼ºåˆ¶å…œåº•ï¼‰

**æ ¸å¿ƒåŸåˆ™**ï¼š
```
æœ¬åœ° Hooks = åŠ é€Ÿå¤±è´¥ï¼ˆæå‰å‘ç°é—®é¢˜ï¼‰
è¿œç«¯ CI + Branch Protection = æœ€ç»ˆå¼ºåˆ¶ï¼ˆç‰©ç†é˜»æ­¢åˆå¹¶ï¼‰
```

**æ‰¿è®¤ç°å®**ï¼š
- æœ¬åœ° Hook å¯ä»¥è¢«ç»•è¿‡ï¼ˆæ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶ã€skip hooksã€åˆ é™¤é…ç½®ï¼‰
- ä¸è¿½æ±‚"æœ¬åœ° 100% å°å µ"
- ç”¨è¿œç«¯ CI + Branch Protection ä½œä¸ºæœ€ç»ˆé˜²çº¿

**èŒè´£æ˜ å°„**ï¼š

| è´¨æ£€è¦æ±‚ | æœ¬åœ°æ£€æŸ¥ | è¿œç«¯å¼ºåˆ¶ | ç»•è¿‡åæœ |
|---------|---------|----------|----------|
| **PRD/DoD å­˜åœ¨** | âœ… `hooks/branch-protect.sh` | âŒ æ—  | å¯ç»•è¿‡ï¼Œä½† PR Gate ä¼šæ£€æŸ¥ |
| **è´¨æ£€é€šè¿‡ (L1)** | âœ… `hooks/stop.sh` | âœ… **CI: test job** | è¿œç«¯å…œåº•ï¼Œå¿…é¡»é€šè¿‡ |
| **Audit PASS (L2A)** | âœ… `hooks/stop.sh` | âœ… **CI: evidence-gate** | è¿œç«¯å…œåº•ï¼ŒéªŒè¯è¯æ® |
| **èƒ½åŠ›ç™»è®°** | âŒ æ—  | âœ… **CI: impact-check** | åªèƒ½é è¿œç«¯æ£€æµ‹ |
| **è´¨æ£€è¯æ®æœ‰æ•ˆ** | âŒ æ—  | âœ… **CI: evidence-gate** | è¿œç«¯éªŒè¯ SHA åŒ¹é… |
| **æµ‹è¯•é€šè¿‡** | âœ… `npm run qa:gate` | âœ… **CI: test job** | è¿œç«¯å¼ºåˆ¶æ‰§è¡Œ |
| **ç‰ˆæœ¬å·æ›´æ–°** | âŒ æ—  | âœ… **CI: version-check** | è¿œç«¯å¼ºåˆ¶æ£€æŸ¥ |
| **åˆå¹¶æƒé™** | âŒ æ—  | âœ… **Branch Protection** | GitHub ç‰©ç†é˜»æ­¢ |

**Branch Protection è¦æ±‚**ï¼š

å¿…é¡»é…ç½®ä»¥ä¸‹ Required Status Checksï¼š
```yaml
required_status_checks:
  strict: true
  checks:
    - context: test              # L1 + DevGate
    - context: impact-check      # P0-1: èƒ½åŠ›å˜æ›´ç™»è®°
    - context: evidence-gate     # P0-2: è´¨æ£€è¯æ®éªŒè¯
    - context: version-check     # ç‰ˆæœ¬å·æ£€æŸ¥
```

**Admin Enforcementï¼ˆå…³é”®ï¼‰**ï¼š
```yaml
enforce_admins: true  # âš ï¸ å¿…é¡»å¼€å¯ï¼Œå¦åˆ™ Admin å¯ç»•è¿‡ CI
```

**ä¸ºä»€ä¹ˆä¸ç”¨è„šæœ¬éªŒè¯ Branch Protectionï¼Ÿ**
- ~~`scripts/verify-branch-protection.sh`~~ âŒ **å·²åˆ é™¤**
- **ç†ç”±**ï¼š
  1. GitHub åç«¯å¼ºåˆ¶ï¼šBranch Protection æ˜¯ GitHub æœåŠ¡ç«¯æ‰§è¡Œçš„
  2. CI æ— æ³•éªŒè¯ï¼šCI è¿è¡Œåœ¨ PR ä¸­ï¼Œæ— æ³•ä¿®æ”¹ GitHub è®¾ç½®
  3. è„šæœ¬æ— æ„ä¹‰ï¼šåªèƒ½è¯»å–é…ç½®ï¼Œæ— æ³•å¼ºåˆ¶æ‰§è¡Œ
  4. é…ç½®ä¼šæ¼‚ç§»ï¼šè„šæœ¬éªŒè¯é€šè¿‡ â‰  GitHub å®é™…é…ç½®æ­£ç¡®

**æ­£ç¡®åšæ³•**ï¼š
- æ‰‹åŠ¨æ£€æŸ¥ GitHub è®¾ç½®ï¼ˆSettings â†’ Branches â†’ Branch protection rulesï¼‰
- ä½¿ç”¨ `gh api` ä¸€æ¬¡æ€§éªŒè¯ï¼š
  ```bash
  gh api repos/:owner/:repo/branches/main/protection --jq '.enforce_admins.enabled'
  # åº”è¾“å‡º: true
  ```

---

## ä¸‰å¥—åˆ†å±‚ç³»ç»Ÿï¼ˆäº’ä¸å†²çªï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸‰ç»„åˆ†å±‚ç³»ç»Ÿï¼ˆä¸è¦æ··ï¼‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1ï¸âƒ£ è´¨æ£€æµç¨‹åˆ†å±‚ï¼ˆ/dev å·¥ä½œæµç”¨ï¼‰                       â”‚
â”‚     ç”¨é€”: å®šä¹‰ PR/Release æ¨¡å¼çš„æ£€æŸ¥é¡¹                  â”‚
â”‚     å±‚çº§: L1 / L2A / L2B / L3                           â”‚
â”‚                                                         â”‚
â”‚  2ï¸âƒ£ é—®é¢˜ä¸¥é‡æ€§åˆ†å±‚ï¼ˆ/audit ä»£ç å®¡è®¡ç”¨ï¼‰                 â”‚
â”‚     ç”¨é€”: Audit Node è¾“å‡ºçš„é—®é¢˜åˆ†çº§                     â”‚
â”‚     å±‚çº§: L1 / L2 / L3 / L4                             â”‚
â”‚                                                         â”‚
â”‚  3ï¸âƒ£ æµ‹è¯•è¦†ç›–åº¦åˆ†å±‚ï¼ˆ/qa å®¡è®¡ç”¨ï¼‰                        â”‚
â”‚     ç”¨é€”: QA æˆç†Ÿåº¦å®¡è®¡                                 â”‚
â”‚     å±‚çº§: Meta / Unit / E2E                             â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£ è´¨æ£€æµç¨‹åˆ†å±‚ï¼ˆ/dev å·¥ä½œæµï¼‰

**æ¥æº**: `skills/dev/steps/07-quality.md`

| å±‚çº§ | åç§° | å†…å®¹ | ä½•æ—¶è·‘ | å¼ºåˆ¶æ–¹å¼ |
|------|------|------|--------|---------|
| **L1** | è‡ªåŠ¨åŒ–æµ‹è¯• | typecheck + test + build | PR + Release | Stop Hook (æœ¬åœ°) + CI (é‡è·‘) |
| **L2A** | ä»£ç å®¡è®¡ | Audit Node â†’ AUDIT-REPORT.md | PR + Release | Stop Hook (æœ¬åœ°) |
| **L2B** | Evidence è¯æ® | .layer2-evidence.md (æˆªå›¾/curl) | Release only | CI (release-check) |
| **L3** | Acceptance éªŒæ”¶ | DoD å…¨å‹¾ + Evidence å¼•ç”¨ | Release only | CI (release-check) |

### åŒæ¨¡å¼è´¨æ£€

| æ¨¡å¼ | æ£€æŸ¥å†…å®¹ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|
| **PR** (é»˜è®¤) | L1 + L2A | æ—¥å¸¸ PR â†’ develop |
| **Release** | L1 + L2A + L2B + L3 | å‘ç‰ˆ develop â†’ main |

---

## 2ï¸âƒ£ é—®é¢˜ä¸¥é‡æ€§åˆ†å±‚ï¼ˆ/audit ä»£ç å®¡è®¡ï¼‰

**æ¥æº**: `skills/audit/SKILL.md`

| å±‚çº§ | åç§° | å«ä¹‰ | æ˜¯å¦ä¿®å¤ |
|------|------|------|---------|
| **L1** | é˜»å¡æ€§ | å¿…é¡»ä¿®ï¼ˆå®‰å…¨æ¼æ´ã€åŠŸèƒ½é˜»å¡ï¼‰ | âœ… å¿…é¡»ä¿® |
| **L2** | åŠŸèƒ½æ€§ | å»ºè®®ä¿®ï¼ˆåŠŸèƒ½ç¼ºé™·ã€è¾¹ç•Œé—®é¢˜ï¼‰ | âœ… å»ºè®®ä¿® |
| **L3** | æœ€ä½³å®è·µ | å¯é€‰ä¿®ï¼ˆä»£ç è§„èŒƒã€æ€§èƒ½ä¼˜åŒ–ï¼‰ | ğŸŸ¡ å¯é€‰ä¿® |
| **L4** | è¿‡åº¦ä¼˜åŒ– | ä¸ä¿®ï¼ˆè¿‡åº¦å·¥ç¨‹ã€æ— ä»·å€¼ä¼˜åŒ–ï¼‰ | âŒ ä¸ä¿® |

### Audit Decision

```yaml
Decision: PASS | FAIL

Summary:
  L1: 0  # é˜»å¡æ€§é—®é¢˜æ•°
  L2: 0  # åŠŸèƒ½æ€§é—®é¢˜æ•°
  L3: X  # æœ€ä½³å®è·µé—®é¢˜æ•°ï¼ˆå¯é€‰ï¼‰
  L4: X  # è¿‡åº¦ä¼˜åŒ–é—®é¢˜æ•°ï¼ˆæ ‡è®°ä½†ä¸ä¿®ï¼‰

Blockers: []  # L1 + L2 é—®é¢˜åˆ—è¡¨
```

**Gate æ£€æŸ¥**:
- Stop Hook: `Decision: PASS` ä¸” `L1 + L2 = 0`
- PR Gate: `docs/AUDIT-REPORT.md` å­˜åœ¨ + Decision: PASS

---

## 3ï¸âƒ£ æµ‹è¯•è¦†ç›–åº¦åˆ†å±‚ï¼ˆ/qa å®¡è®¡ï¼‰

**æ¥æº**: `skills/qa/SKILL.md` æ¨¡å¼ 5

| å±‚çº§ | åç§° | å†…å®¹ | ç”¨é€” |
|------|------|------|------|
| **Meta** | å…ƒæµ‹è¯• | regression-contract, hooks, gates, ci | æµ‹è¯•æ¡†æ¶æœ¬èº« |
| **Unit** | å•å…ƒæµ‹è¯• | tests/, vitest, npm test | ä»£ç å•å…ƒéªŒè¯ |
| **E2E** | ç«¯åˆ°ç«¯æµ‹è¯• | golden_paths, e2e/ | ä¸šåŠ¡æµç¨‹éªŒè¯ |

### QA å®¡è®¡è¾“å‡º

```
[QA Audit Report]

RepoType: Engine | Business

Meta Layer:  XX% (regression-contract, hooks, gates, ci)
Unit Layer:  XX% (tests/, vitest, npm test)
E2E Layer:   XX% (golden_paths, e2e/)

Missing:
  - [ ] golden_paths æœªå®šä¹‰
  - [ ] E2E è„šæœ¬ç¼ºå¤±

Recommendations:
  1. è¡¥ golden_paths
  2. ...
```

---

## å¼ºåˆ¶é¡¹å®šä¹‰

### æœ¬åœ°å¼ºåˆ¶ï¼ˆStop Hookï¼‰

**è„šæœ¬**: `hooks/stop.sh`
**è§¦å‘**: StopHook äº‹ä»¶ï¼ˆä¼šè¯ç»“æŸå‰ï¼‰
**èƒ½åŠ›**: 100% å¼ºåˆ¶ï¼ˆexit 2 é˜»æ­¢ä¼šè¯ç»“æŸï¼‰

#### p0 é˜¶æ®µå¼ºåˆ¶é¡¹

```bash
# L2A: ä»£ç å®¡è®¡
âœ… docs/AUDIT-REPORT.md å­˜åœ¨
âœ… Decision: PASS
âœ… L1 + L2 = 0ï¼ˆblocker æ¸…é›¶ï¼‰

# L1: è‡ªåŠ¨åŒ–æµ‹è¯•
âœ… npm run qa é€šè¿‡
âœ… .quality-gate-passed å­˜åœ¨

# PR åˆ›å»º
âœ… gh pr list --head $BRANCH è¿”å› PR number
```

**ä¸é€šè¿‡ â†’ exit 2 â†’ é˜»æ­¢ä¼šè¯ç»“æŸ â†’ ç»§ç»­ä¿®å¤**

#### p1 é˜¶æ®µå¼ºåˆ¶é¡¹

```bash
# CI çŠ¶æ€æ£€æŸ¥
CI_STATUS=$(gh pr checks $PR_NUMBER)

âŒ FAILURE â†’ exit 2ï¼ˆç»§ç»­ä¿®ï¼‰
â³ PENDING â†’ exit 0ï¼ˆé€€å‡ºï¼Œç­‰å”¤é†’ï¼‰
âœ… SUCCESS â†’ exit 0ï¼ˆç»“æŸï¼‰
```

### CI å¼ºåˆ¶ï¼ˆGitHub Actionsï¼‰

**é…ç½®**: `.github/workflows/ci.yml`
**èƒ½åŠ›**: PR åˆå¹¶å‰å¿…é¡»é€šè¿‡ï¼ˆBranch Protection Rulesï¼‰

#### test job å¼ºåˆ¶é¡¹

```yaml
- npm ci
- npm run typecheck    # L1
- npm run test         # L1
- npm run build        # L1
- bash -n *.sh         # shell syntax check
- DevGate checks:
    - check-dod-mapping.cjs       # DoD æ˜ å°„
    - require-rci-update-if-p0p1.sh  # P0/P1 RCI æ›´æ–°
    - scan-rci-coverage.cjs       # RCI è¦†ç›–ç‡
```

#### version-check job å¼ºåˆ¶é¡¹

```yaml
- package.json version å¿…é¡»æ›´æ–°ï¼ˆPR æ—¶ï¼‰
- semver æ ¼å¼éªŒè¯ï¼ˆMAJOR.MINOR.PATCHï¼‰
```

#### release-check job å¼ºåˆ¶é¡¹ï¼ˆä»… PR to mainï¼‰

```yaml
- L3 å›å½’æµ‹è¯•: bash scripts/run-regression.sh release
- L4 Evidence Check:
    - .layer2-evidence.md å­˜åœ¨
    - .dod.md å…¨å‹¾ï¼ˆæ—  [ ]ï¼‰
```

---

## æœ¬åœ° vs CI è¾¹ç•Œ

| æ£€æŸ¥é¡¹ | æœ¬åœ°ï¼ˆStop Hookï¼‰ | CIï¼ˆGitHub Actionsï¼‰ | åŸå›  |
|--------|------------------|---------------------|------|
| L1 è‡ªåŠ¨åŒ–æµ‹è¯• | âœ… å¼ºåˆ¶ | âœ… é‡è·‘ï¼ˆé˜²ç»•è¿‡ï¼‰ | åŒé‡ä¿æŠ¤ |
| L2A ä»£ç å®¡è®¡ | âœ… å¼ºåˆ¶ | âŒ ä¸é‡è·‘ | æœ¬åœ°å·²æ£€æŸ¥ |
| L2B Evidence | âŒ ä¸æ£€æŸ¥ | âœ… Release æ¨¡å¼ | ä»…å‘ç‰ˆéœ€è¦ |
| L3 éªŒæ”¶ | âŒ ä¸æ£€æŸ¥ | âœ… Release æ¨¡å¼ | ä»…å‘ç‰ˆéœ€è¦ |
| DevGate | âŒ ä¸æ£€æŸ¥ | âœ… å¼ºåˆ¶ | æœåŠ¡å™¨ç«¯æ£€æŸ¥ |
| ç‰ˆæœ¬å· | âŒ ä¸æ£€æŸ¥ | âœ… å¼ºåˆ¶ | å›¢é˜Ÿè§„èŒƒ |

**åŸåˆ™**:
- **æœ¬åœ°å¼ºåˆ¶**ï¼šå¿«é€Ÿåé¦ˆï¼Œ100% å¼ºåˆ¶èƒ½åŠ›ï¼ˆStop Hookï¼‰
- **CI å¼ºåˆ¶**ï¼šé˜²ç»•è¿‡ï¼Œå›¢é˜Ÿè§„èŒƒï¼ŒæœåŠ¡å™¨ç«¯æ£€æŸ¥

---

## è´¨æ£€æµç¨‹å›¾

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  æœ¬åœ°è´¨æ£€ï¼ˆStop Hook å¼ºåˆ¶ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å†™ä»£ç  + å†™æµ‹è¯•
    â†“
L2A: Audit Node (è°ƒç”¨ /audit Skill)
    â”œâ”€ è¾“å‡º: docs/AUDIT-REPORT.md
    â”œâ”€ Decision: PASS | FAIL
    â””â”€ Blockers: L1 + L2 é—®é¢˜åˆ—è¡¨
    â†“
Blocker æ£€æŸ¥:
    âŒ blocker > 0 â†’ åœæ­¢ï¼Œä¿®å¤ â†’ é‡æ–°å®¡è®¡
    âœ… blocker = 0 â†’ ç»§ç»­ L1
    â†“
L1: npm run qa (typecheck + test + build)
    â”œâ”€ æˆåŠŸ: ç”Ÿæˆ .quality-gate-passed
    â””â”€ å¤±è´¥: ä¿®å¤ â†’ é‡è·‘
    â†“
Stop Hook æ£€æŸ¥:
    âŒ AUDIT-REPORT.md ä¸å­˜åœ¨ â†’ exit 2
    âŒ Decision != PASS â†’ exit 2
    âŒ .quality-gate-passed ä¸å­˜åœ¨ â†’ exit 2
    âœ… å…¨éƒ¨é€šè¿‡ â†’ ç»§ç»­ PR åˆ›å»º

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  CI è´¨æ£€ï¼ˆGitHub Actionsï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PR åˆ›å»º â†’ CI è§¦å‘
    â†“
version-check job:
    â”œâ”€ package.json version æ›´æ–°æ£€æŸ¥
    â””â”€ semver æ ¼å¼éªŒè¯
    â†“
test job:
    â”œâ”€ L1 é‡è·‘ (typecheck + test + build)
    â”œâ”€ shell scripts è¯­æ³•æ£€æŸ¥
    â””â”€ DevGate checks:
        â”œâ”€ DoD æ˜ å°„æ£€æŸ¥
        â”œâ”€ P0/P1 RCI æ›´æ–°æ£€æŸ¥
        â””â”€ RCI è¦†ç›–ç‡æ£€æŸ¥
    â†“
release-check job (ä»… PR to main):
    â”œâ”€ L3 å›å½’æµ‹è¯• (bash scripts/run-regression.sh release)
    â””â”€ L4 Evidence + DoD å®Œæˆåº¦æ£€æŸ¥
    â†“
ci-passed:
    âœ… å…¨éƒ¨é€šè¿‡ â†’ å…è®¸åˆå¹¶

notify-failure (CI fail æ—¶):
    âŒ å¤±è´¥ â†’ è®°å½•åˆ°æ•°æ®åº“ â†’ è§¦å‘ p1 ä¿®å¤
```

---

## äº§ç‰©æ¸…å•

| äº§ç‰© | ä½ç½® | ç”Ÿæˆè€… | Gate æ£€æŸ¥ | è¯´æ˜ |
|------|------|--------|-----------|------|
| PRD | `.prd.md` | Step 1 | Branch Protect | éœ€æ±‚æ–‡æ¡£ |
| QA Decision | `docs/QA-DECISION.md` | Step 4 (QA Node) | PR Gate | æµ‹è¯•å†³ç­– |
| DoD | `.dod.md` | Step 4 | PR Gate | éªŒæ”¶æ¸…å• |
| Audit Report | `docs/AUDIT-REPORT.md` | Step 7 (Audit Node) | Stop Hook + PR Gate | å®¡è®¡æŠ¥å‘Š |
| Quality Gate | `.quality-gate-passed` | Step 7 (npm run qa) | Stop Hook | æµ‹è¯•é€šè¿‡æ ‡è®° |
| Evidence | `.layer2-evidence.md` | Release æ¨¡å¼ | CI (release-check) | è¯æ®æ–‡ä»¶ |

---

## Gate æ£€æŸ¥çŸ©é˜µ

| Gate | è§¦å‘æ—¶æœº | æ£€æŸ¥å†…å®¹ | å¼ºåˆ¶èƒ½åŠ› |
|------|---------|----------|---------|
| **Branch Protect** | PreToolUse:Write/Edit | åˆ†æ”¯æ£€æµ‹ | 100% (exit 2) |
| **Stop Hook** | StopHook | L2A + L1 + PR (p0) / CI (p1) | 100% (exit 2) |
| **PR Gate** | PreToolUse:Bash (gh pr create) | äº§ç‰©å­˜åœ¨ + åŒæ¨¡å¼ | 100% (exit 2) |
| **CI** | PR åˆ›å»ºå | L1 é‡è·‘ + DevGate + ç‰ˆæœ¬å· | 100% (Branch Protection) |

---

## æœ¯è¯­æ˜ å°„è¡¨

| æ¦‚å¿µ | è´¨æ£€æµç¨‹å±‚ï¼ˆ/devï¼‰ | é—®é¢˜ä¸¥é‡æ€§å±‚ï¼ˆ/auditï¼‰ | æµ‹è¯•è¦†ç›–åº¦å±‚ï¼ˆ/qaï¼‰ |
|------|-------------------|----------------------|-------------------|
| L1 | è‡ªåŠ¨åŒ–æµ‹è¯• | é˜»å¡æ€§é—®é¢˜ | - |
| L2 | - | åŠŸèƒ½æ€§é—®é¢˜ | - |
| L2A | ä»£ç å®¡è®¡ | - | - |
| L2B | Evidence è¯æ® | - | - |
| L3 | Acceptance éªŒæ”¶ | æœ€ä½³å®è·µé—®é¢˜ | - |
| L4 | - | è¿‡åº¦ä¼˜åŒ–é—®é¢˜ | - |
| Meta | - | - | å…ƒæµ‹è¯•å±‚ |
| Unit | - | - | å•å…ƒæµ‹è¯•å±‚ |
| E2E | - | - | ç«¯åˆ°ç«¯æµ‹è¯•å±‚ |

**é‡è¦**: è¿™ä¸‰å¥—åˆ†å±‚å„æœ‰ç”¨é€”ï¼Œäº’ä¸å†²çªã€‚

---

## éªŒæ”¶æ ‡å‡†

### æœ¬åœ°å¼ºåˆ¶éªŒæ”¶

```bash
# æµ‹è¯• Stop Hook å¼ºåˆ¶èƒ½åŠ›
# åœºæ™¯ 1: è´¨æ£€æœªè¿‡
rm docs/AUDIT-REPORT.md
# é¢„æœŸ: exit 2ï¼ˆé˜»æ­¢ç»“æŸï¼‰

# åœºæ™¯ 2: æµ‹è¯•æœªè¿‡
rm .quality-gate-passed
# é¢„æœŸ: exit 2ï¼ˆé˜»æ­¢ç»“æŸï¼‰

# åœºæ™¯ 3: å…¨éƒ¨é€šè¿‡
# é¢„æœŸ: exit 0ï¼ˆå…è®¸ç»“æŸï¼‰
```

### CI å¼ºåˆ¶éªŒæ”¶

```bash
# æµ‹è¯• CI é—¨ç¦
# åœºæ™¯ 1: ç‰ˆæœ¬å·æœªæ›´æ–°
# é¢„æœŸ: version-check å¤±è´¥

# åœºæ™¯ 2: æµ‹è¯•å¤±è´¥
# é¢„æœŸ: test job å¤±è´¥

# åœºæ™¯ 3: DevGate å¤±è´¥
# é¢„æœŸ: DevGate checks å¤±è´¥
```

---

## ç›¸å…³æ–‡æ¡£

- `features/feature-registry.yml` - Feature å®šä¹‰ï¼ˆH1/H2/H7ï¼‰
- `skills/dev/steps/07-quality.md` - è´¨æ£€æµç¨‹è¯¦ç»†è¯´æ˜
- `skills/audit/SKILL.md` - ä»£ç å®¡è®¡è§„èŒƒ
- `skills/qa/SKILL.md` - QA æ€»æ§è§„èŒƒ
- `hooks/stop.sh` - Stop Hook å®ç°
- `hooks/pr-gate-v2.sh` - PR Gate å®ç°
- `.github/workflows/ci.yml` - CI é…ç½®

---

**ç‰ˆæœ¬**: 2.0.0
**çŠ¶æ€**: âœ… Production Ready
**æœ€åæ›´æ–°**: 2026-01-24
