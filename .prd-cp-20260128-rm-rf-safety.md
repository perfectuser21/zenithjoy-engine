---
id: prd-rm-rf-safety
version: 1.0.0
created: 2026-01-28
updated: 2026-01-28
changelog:
  - 1.0.0: 初始版本
---

# PRD: rm -rf 安全验证

## 背景

深度代码审计发现多处 `rm -rf` 使用未对变量进行充分验证，存在命令注入或误删风险。

## 问题文件

| 文件 | 行号 | 变量 | 风险 |
|------|------|------|------|
| worktree-manage.sh | 198 | $worktree_path | 路径来自 git 命令解析 |
| cleanup.sh | 190 | $WORKTREE_PATH | 路径来自 git 命令解析 |
| deploy.sh | 173 | $target_skill | 路径拼接 |

## 目标

为所有 `rm -rf` 添加安全验证：
1. 变量非空检查
2. 路径存在检查
3. 路径在允许范围内检查（防止删除系统目录）

## 验收标准

- [ ] 所有 `rm -rf` 前有 safe_rm_rf 函数调用或内联验证
- [ ] 测试通过
