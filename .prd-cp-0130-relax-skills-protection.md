---
id: prd-relax-skills-protection
version: 1.0.0
created: 2026-01-30
updated: 2026-01-30
changelog:
  - 1.0.0: 初始版本
---

# PRD: 放宽全局 Skills 目录保护

## 需求来源

当前 `branch-protect.sh` 锁死了整个 `~/.claude/skills/` 目录，导致：
- 所有 skills 只能从 Engine 部署
- HR (Cecelia-OS) 无法部署自己的 skills
- 业务 repo 无法部署业务特定 skills

## 功能描述

修改 `branch-protect.sh`，将"全目录保护"改为"特定 skills 保护"：

- **保护**：Engine 相关的 skills（dev, qa, audit, semver）
- **放行**：其他 skills 允许从任何 repo 部署

## 成功标准

1. `~/.claude/skills/dev/` 等 Engine skills 仍受保护
2. `~/.claude/skills/script-manager/` 等非 Engine skills 可以被创建/修改
3. `~/.claude/hooks/` 仍然受保护（不变）

## 技术方案

修改 `hooks/branch-protect.sh` 第 74-92 行：

```bash
# 改前：锁死整个目录
if [[ "$FILE_PATH" == "$HOME_DIR/.claude/skills/"* ]]; then
    exit 2
fi

# 改后：只保护特定 skills
PROTECTED_SKILLS="dev|qa|audit|semver"
if [[ "$FILE_PATH" =~ \.claude/skills/($PROTECTED_SKILLS)/ ]]; then
    exit 2  # Engine skills 受保护
fi
# 其他 skills 放行
```

## 影响范围

- `hooks/branch-protect.sh`
