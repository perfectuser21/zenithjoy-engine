# PRD - 修复 /dev 自动执行流程

## 功能描述

修复 `/dev` skill 的自动执行流程，确保 AI 在完成一个步骤后立即执行下一步，而不是停下来等待用户确认。

## 问题现状

**症状**：
- AI 执行完 Step 4 (DoD + QA Decision) 后停下来
- 输出"QA 决策已生成！现在返回 /dev 流程继续执行..."
- 但实际上没有继续，而是等待用户催促

**根本原因**：
1. `SKILL.md` 中缺少明确的"强制连续执行"指令
2. 步骤文件（如 `04-dod.md`）的"完成后"部分只是描述性的，不是执行性的
3. AI 把流程图当成说明文档，而不是必须执行的指令

## 成功标准

### 行为验证
- [ ] AI 完成 Step 4 后立即读取并执行 Step 5
- [ ] AI 完成 Step 5 后立即读取并执行 Step 6
- [ ] 不会在中途停顿输出总结或等待确认
- [ ] 一直执行到 Step 8 创建 PR 为止

### 代码验证
- [ ] `SKILL.md` 包含明确的"自动执行规则"章节
- [ ] 每个步骤文件的"完成后"都包含强制性的"立即执行下一步"指令
- [ ] 不存在矛盾的指令（如"等待确认"、"输出总结"）

## 实现方案

### 1. SKILL.md 添加强制执行规则

在 `## 核心定位` 之后，添加：

```markdown
## ⚡ 自动执行规则（CRITICAL）

**每个步骤完成后，必须立即执行下一步，不要等待用户确认或输出总结**。

执行流程：
Step N 完成 → 立即读取 skills/dev/steps/{N+1}-xxx.md → 执行下一步

禁止行为：
- ❌ 完成一步后输出"已完成，等待用户确认"
- ❌ 完成一步后停下来总结
- ❌ 询问用户"是否继续下一步"

正确行为：
- ✅ 完成 Step 4 (DoD) → 立即执行 Step 5 (Code)
- ✅ 完成 Step 5 (Code) → 立即执行 Step 6 (Test)
- ✅ 一直执行到 Step 8 (PR) 创建 PR 为止

唯一停止点：PR 创建成功后（p0 阶段结束）
```

### 2. 修复每个步骤文件的"完成后"

需要修改的文件：
- `skills/dev/steps/04-dod.md`
- `skills/dev/steps/05-code.md`
- `skills/dev/steps/06-test.md`
- `skills/dev/steps/07-quality.md`

**原先（弱）**：
```markdown
## 完成后
**DoD 定稿后，进入 Step 5：写代码**
```

**修复后（强）**：
```markdown
## 完成后

立即执行下一步：
1. 读取 `skills/dev/steps/05-code.md`
2. 立即开始写代码
3. 不要输出总结或等待确认
```

### 3. 排查并消除矛盾信息

检查以下文件，确保没有矛盾指令：
- `skills/dev/SKILL.md` - 流程图和文字描述
- `skills/dev/steps/*.md` - 每个步骤的"完成后"部分
- `CLAUDE.md` - 全局规则
- `~/.claude/CLAUDE.md` - 用户配置

## 需求来源

用户反馈：原先的 /dev 流程可以一次性执行到完，但现在会在步骤间停顿。

## 验收方式

1. 修改完成后，用户重新运行 `/dev` 测试
2. 观察 AI 是否能连续执行所有步骤
3. 确认没有中途停顿或等待用户确认的行为
