---
id: prd-fix-priority-detection-and-rci
version: 1.0.0
created: 2026-01-23
updated: 2026-01-23
changelog:
  - 1.0.0: 初始版本
---

# PRD - 修复优先级检测 Bug 并补充 RCI

Priority: P0

## 需求来源

深度审计发现 13 个 CRITICAL 安全问题并修复（v8.24.0），但由于 `detect-priority.cjs` 不识别 CRITICAL/HIGH 关键字，导致：
1. 未触发 P0/P1 RCI 更新检查
2. 未在 regression-contract.yaml 添加回归契约
3. 安全修复无回归测试保护

这本身是一个 P0 级 bug：安全修复绕过了 RCI 要求。

## 功能描述

### Checkpoint 1: 修复 detect-priority.cjs Bug
- 添加 CRITICAL → P0 映射
- 添加 HIGH → P1 映射
- 添加 security 关键字 → P0 映射
- 添加单元测试覆盖

### Checkpoint 2: 补充 v8.24.0 安全修复的 RCI
为 13 个 CRITICAL 修复添加 regression-contract.yaml 条目：
- JSON 预验证 (hooks)
- 路径遍历检查 (hooks)
- sed 注入防护 (hooks)
- id 格式验证 (scripts)
- 变量安全处理 (scripts)
- CI Job 权限声明 (ci)
- curl JSON 安全生成 (ci)

### Checkpoint 3: 更新文档
- 更新 QA SKILL.md 说明 CRITICAL/HIGH 与 P0/P1 的映射关系
- 更新 Audit SKILL.md 添加映射说明

## 成功标准

- detect-priority.cjs 能正确识别 CRITICAL/HIGH/security 关键字
- v8.24.0 的 13 个安全修复有对应 RCI 覆盖
- npm run qa 通过
- 新增 RCI 测试通过
