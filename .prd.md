---
id: prd-zero-escape-org-migration
version: 1.0.0
created: 2026-01-24
updated: 2026-01-24
changelog:
  - 1.0.0: 初始版本
---

# PRD - Zero-Escape A+ 组织仓库迁移

Priority: P0

## 背景

当前仓库状态：
- 个人仓库（perfectuser21/zenithjoy-engine）
- 保护等级：A- (95%)
- 缺失：Push Restrictions（个人仓库不支持）
- 问题：Owner 可以绕过所有规则

**目标**：迁移到 GitHub Organization，实现 A+ (100%) Zero-Escape 保护。

## 目标

实现真正不可绕过的服务器侧门禁（Zero-Escape A+）：
- ✅ 任何人（包括 owner）都无法 push main/develop
- ✅ 任何人（包括 owner）都无法绕过 CI 合并
- ✅ 只有 Merge Bot 能完成最终 merge
- ✅ 所有规则在服务器侧强制（不依赖本地 hook）

## Phase 0: 盘点与差距分析

### 任务
- 查询当前仓库状态（private、分支保护、rulesets 支持）
- 生成 Gap Report（已达成 vs 未达成）
- 用 API 证据说明为什么个人仓库无法达到 100%

### 交付物
- `docs/trust/GAP-REPORT.md`
- API 查询输出的关键字段

## Phase 1: 创建组织

### 任务
- 创建 GitHub Organization: `ZENITHJOYAI`
- 确认组织允许 private repo
- 配置组织权限策略（禁止任何人直接写 main/develop）

### 交付物
- `docs/trust/ORG-SETUP.md`（org 名称、私有策略、成员权限）

## Phase 2: 迁移仓库

### 任务
- 将 `perfectuser21/zenithjoy-engine` 迁移到 `ZENITHJOYAI/zenithjoy-engine`
- 保持 PRIVATE
- 确认历史完整（issues/PR/commits）
- 更新远程 URL

### 交付物
- `docs/trust/REPO-TRANSFER.md`
- 新仓库地址
- git remote set-url 命令

## Phase 3: 实现 A+ Zero-Escape

### 3.1 Rulesets 配置
- Require PR
- Require status checks（gate:test + CI）
- Require branches up to date
- Block force push / deletions
- 禁止 bypass（包括管理员）
- **Push restrictions: main/develop 仅允许 Merge Bot**

### 3.2 Merge Bot 实现
选项 A（优先）：GitHub App
- 最小权限：读 PR、读 checks、执行 merge
- 作为唯一写入者

选项 B：机器人账号
- 最小权限
- 作为唯一 allowed actor

### 交付物
- `features/trust-layer/ZERO-ESCAPE-A+.md`
- `scripts/trust-proof-suite-v2.sh`（验证脚本，>=15 项测试）
- CI job：每次 release 前跑 trust-proof-suite-v2

## 验收标准

### 功能验收
- [ ] 任何人都无法 push main/develop
- [ ] 任何人都无法通过 API/CLI 绕过 checks 合并
- [ ] 只有 Merge Bot 能完成最终 merge
- [ ] 所有规则在服务器侧强制
- [ ] trust-proof-suite-v2.sh 全部通过（>=15 项）

### 证据要求
- [ ] API 查询结果（证明 restrictions 生效）
- [ ] 实际测试（尝试直推失败）
- [ ] 仓库历史完整（迁移后验证）

## 约束条件

1. **仓库必须保持 PRIVATE**（不公开，不开源）
2. **不接受"靠自律"的方案**（必须权限层面不可绕过）
3. **历史不能丢失**（issues/PR/commits 必须保留）
4. **每个阶段必须产出可验证证据**

## 风险与回滚

### 风险点
- 组织迁移可能影响 CI/CD token
- 远程 URL 变更需要更新本地配置
- 协作者需要重新授权

### 回滚方案
- 迁移前备份所有配置
- 如果迁移失败，可以从组织转回个人账户
- 保留原仓库的完整备份

## 成功标准

运行 `scripts/trust-proof-suite-v2.sh` 输出：
```
Passed: >= 15/15
Failed: 0
Status: A+ (100%) - Organization Zero-Escape compliant
```
