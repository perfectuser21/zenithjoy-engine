---
id: prd-worktree-detect
version: 1.0.0
created: 2026-01-23
updated: 2026-01-23
changelog:
  - 1.0.0: 初始版本
---

# PRD - Worktree 并行开发检测

Priority: P2

## 背景

当前 /dev 工作流缺少并行开发检测：
- 没有检测是否有未合并的 cp-*/feature/* 分支
- 没有提示使用 worktree 隔离并行开发
- 只能串行开发或手动切换分支

## 目标

- 自动检测活跃的功能分支
- 提供 worktree 创建选项，支持并行开发
- 在 cleanup 时自动清理相关 worktree

## 非目标

- 不改变现有分支策略
- 不强制使用 worktree（仍可在主工作区创建新分支）

## 功能描述

### 用户场景

1. 用户在 develop 分支运行 `/dev`
2. 系统检测到有活跃的 cp-* 分支
3. 显示选项：继续现有分支 / 创建 worktree / 在主工作区创建新分支
4. 用户选择 worktree，系统创建并提示切换

### 技术方案

- 新增 Step 2.5 并行检测步骤
- 新增 worktree-manage.sh 管理脚本
- 修改 cleanup.sh 添加 worktree 清理逻辑
- 更新 SKILL.md 和 03-branch.md 文档

## 验收标准

- CI 全绿
- worktree-manage.sh 各命令可正常执行
- 文档准确描述新流程
