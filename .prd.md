---
id: prd-fix-gate-evidence
version: 1.0.0
created: 2026-01-23
updated: 2026-01-23
changelog:
  - 1.0.0: 初始版本
---

# PRD - 修复 PR Gate 证据采集

Priority: P0

## 背景

当前 pr-gate-v2.sh 的测试失败证据采集完全不可信：
1. 使用 mktemp 临时文件，脚本结束后立刻删除
2. 只 tail -10 显示最后 10 行，可能不包含失败清单
3. 没有保存到 artifacts/，无法事后审计
4. 没有解析 JSON 输出，不知道具体哪些测试失败

**后果**：门禁失败时没有可靠证据，导致必须用 gh api 绕过 Hook。

## 目标

1. 保存完整门禁日志到 artifacts/pr-gate/
2. 失败时输出完整失败测试清单（不只是 tail -10）
3. 统一 Hook 和 CI 环境（CI=true、固定 TZ 等）

## 验收标准

- 门禁日志保存到 artifacts/pr-gate/gate-{timestamp}.log
- 失败时可以从日志中找到所有失败测试
- Hook 环境和独立运行结果一致
